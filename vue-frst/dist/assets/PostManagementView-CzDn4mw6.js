import{d as S,r as E,X as b,o as G,G as U,a as e,w as a,an as n,b as F,g as Y,u as h,s as z,q as p,l as J,c as W,t as _,aG as $,y as D,C as j,A as K,B as q,D as P,_ as X}from"./index-B8L1PXQk.js";import{A as y}from"./AdminService-D7bLfGG4.js";const O={class:"post-management-view"},Q=S({__name:"PostManagementView",setup(Z){const g=E([]),c=E(!1),r=b({currentPage:1,limit:10,totalPosts:0,totalPages:1}),s=b({search:"",status:"ALL"}),i=async()=>{c.value=!0;try{const t=await y.getPosts({page:r.currentPage,limit:r.limit,search:s.search||void 0,status:s.status==="ALL"||!s.status?void 0:s.status});g.value=t.posts,r.totalPosts=t.totalPosts,r.totalPages=t.totalPages}catch(t){console.error("Failed to fetch posts:",t)}finally{c.value=!1}},C=t=>{r.currentPage=t,i()},V=t=>{j.confirm(`确定要删除帖子 "${t.title}" (ID: ${t.id})吗？此操作会将帖子状态标记为 ARCHIVED。`,"确认删除",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then(async()=>{c.value=!0;try{await y.deletePost(t.id),i()}catch{}finally{c.value=!1}}).catch(()=>{K.info("已取消删除")})},w=t=>t?q(t).format("YYYY-MM-DD HH:mm:ss"):"N/A",A=t=>{if(!t)return"未知";switch(t){case"PUBLISHED":return"已发布";case"PENDING_REVIEW":return"待审核";case"ARCHIVED":return"已删除";case"DRAFT":return"草稿";case"REJECTED":return"已拒绝";default:return t}},I=t=>{if(!t)return"info";switch(t){case"PUBLISHED":return"success";case"PENDING_REVIEW":return"warning";case"ARCHIVED":return"danger";case"DRAFT":return"info";case"REJECTED":return"danger";default:return"info"}};return G(()=>{i()}),(t,o)=>{const R=n("el-input"),m=n("el-form-item"),u=n("el-option"),T=n("el-select"),v=n("el-button"),B=n("el-form"),d=n("el-table-column"),H=n("el-link"),N=n("el-tag"),k=n("el-table"),x=n("el-pagination"),L=n("el-card"),M=J("loading");return P(),U("div",O,[e(L,null,{header:a(()=>o[2]||(o[2]=[D("div",{class:"card-header"},[D("span",null,"帖子管理")],-1)])),default:a(()=>[e(B,{inline:!0,model:s,class:"filter-form"},{default:a(()=>[e(m,{label:"搜索"},{default:a(()=>[e(R,{modelValue:s.search,"onUpdate:modelValue":o[0]||(o[0]=l=>s.search=l),placeholder:"标题/内容",clearable:"",onKeyup:Y(i,["enter"])},null,8,["modelValue"])]),_:1}),e(m,{label:"状态"},{default:a(()=>[e(T,{modelValue:s.status,"onUpdate:modelValue":o[1]||(o[1]=l=>s.status=l),placeholder:"选择状态",clearable:"",onChange:i},{default:a(()=>[e(u,{label:"全部",value:"ALL"}),e(u,{label:"已发布",value:"PUBLISHED"}),e(u,{label:"待审核",value:"PENDING_REVIEW"}),e(u,{label:"已删除",value:"ARCHIVED"}),e(u,{label:"草稿",value:"DRAFT"}),e(u,{label:"已拒绝",value:"REJECTED"})]),_:1},8,["modelValue"])]),_:1}),e(m,null,{default:a(()=>[e(v,{type:"primary",onClick:i,icon:h(z),loading:c.value},{default:a(()=>o[3]||(o[3]=[p("查询")])),_:1},8,["icon","loading"])]),_:1})]),_:1},8,["model"]),F((P(),W(k,{data:g.value,style:{width:"100%"}},{default:a(()=>[e(d,{prop:"id",label:"ID",width:"80"}),e(d,{prop:"title",label:"标题","min-width":"180"},{default:a(({row:l})=>[e(H,{type:"primary"},{default:a(()=>[p(_(l.title),1)]),_:2},1024)]),_:1}),e(d,{prop:"author.username",label:"作者",width:"120"},{default:a(({row:l})=>{var f;return[p(_(((f=l.author)==null?void 0:f.username)||"未知作者"),1)]}),_:1}),e(d,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[e(N,{type:I(l.status)},{default:a(()=>[p(_(A(l.status)),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"createdAt",label:"创建时间",width:"180"},{default:a(({row:l})=>[p(_(w(l.createdAt)),1)]),_:1}),e(d,{label:"操作",width:"150"},{default:a(({row:l})=>[e(v,{size:"small",type:"danger",onClick:f=>V(l),disabled:l.status==="ARCHIVED",icon:h($)},{default:a(()=>o[4]||(o[4]=[p(" 删除 ")])),_:2},1032,["onClick","disabled","icon"])]),_:1})]),_:1},8,["data"])),[[M,c.value]]),e(x,{background:"",layout:"prev, pager, next, jumper, ->, total",total:r.totalPosts,"page-size":r.limit,"current-page":r.currentPage,onCurrentChange:C,class:"pagination-container"},null,8,["total","page-size","current-page"])]),_:1})])}}}),ae=X(Q,[["__scopeId","data-v-0b493b9f"]]);export{ae as default};
