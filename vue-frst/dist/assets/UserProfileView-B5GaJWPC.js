import{d as oe,C as E,a0 as se,k as D,o as i,u as a,aj as Je,e as n,a as r,c as d,E as be,b as o,f as N,p as He,ak as Ke,h as G,t as U,I as z,g as x,l as C,al as Xe,am as Ye,y as Ze,F as q,Q as T,an as Ge,ao as Qe,ap as el,_ as re,R as ll,r as u,D as te,V as Ce,aq as tl,ar as al,Y as sl,N as Ue,W as ne,P as ae,Z as m,K as $e,S as ol,U as rl,as as Pe,at as B,j as il,n as ue,a5 as nl,a6 as ul,a9 as le,v as Z,X as dl,i as cl,a4 as vl}from"./index-u3ChIZEC.js";const fl={class:"post-image-container"},pl={class:"image-slot error"},gl={key:1,class:"image-slot placeholder"},ml={class:"post-details"},wl={class:"post-header"},hl={class:"author-name"},yl={class:"post-date"},Ul={class:"post-content"},Pl={class:"post-title"},kl={class:"content-preview"},_l=oe({__name:"PostCard",props:{post:{type:Object,required:!0},isAuthor:{type:Boolean,default:!1}},emits:["card-click","edit","delete"],setup(p,{emit:S}){const P=p,h=S,f=()=>{console.log(`[PostCard] handleCardClick triggered for post ID: ${P.post.id}`),h("card-click",P.post.id)},s=E(()=>se(P.post.imageUrl)),$=E(()=>{var _;return se((_=P.post.author)==null?void 0:_.avatarUrl)}),y=E(()=>{var v;if(!((v=P.post)!=null&&v.createdAt))return"";const _=new Date(P.post.createdAt),b=Math.abs(new Date().getTime()-_.getTime()),w=Math.ceil(b/(1e3*60*60*24));return w<1?"今天":w<7?`${w}天前`:_.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})});return(_,c)=>(i(),D(a(Je),{class:"post-card",shadow:"hover","body-style":{padding:"0px"},onClick:f},{default:n(()=>{var b;return[r("div",fl,[p.post.imageUrl?(i(),D(a(be),{key:0,src:s.value,fit:"cover",class:"post-image",lazy:""},{placeholder:n(()=>c[7]||(c[7]=[r("div",{class:"image-slot loading"},"加载中...",-1)])),error:n(()=>[r("div",pl,[o(a(N),null,{default:n(()=>[o(a(He))]),_:1})])]),_:1},8,["src"])):(i(),d("div",gl,[o(a(N),null,{default:n(()=>[o(a(Ke))]),_:1})]))]),r("div",ml,[r("div",wl,[o(a(G),{size:30,src:$.value},null,8,["src"]),r("span",hl,U(((b=p.post.author)==null?void 0:b.name)||"匿名用户"),1),r("span",yl,U(y.value),1)]),r("div",Ul,[r("p",Pl,U(p.post.title||"无标题"),1),r("p",kl,U(p.post.content?p.post.content.substring(0,80)+"...":"无内容"),1)]),r("div",{class:"post-footer",onClick:c[6]||(c[6]=z(()=>{},["stop"]))},[r("span",{class:"stat-item",onClick:c[0]||(c[0]=z(()=>{},["stop"]))},[o(a(N),null,{default:n(()=>[o(a(Xe))]),_:1}),C(" "+U(p.post.likesCount||0),1)]),r("span",{class:"stat-item",onClick:c[1]||(c[1]=z(()=>{},["stop"]))},[o(a(N),null,{default:n(()=>[o(a(Ye))]),_:1}),C(" "+U(p.post.commentsCount||0),1)]),r("span",{class:"stat-item",onClick:c[2]||(c[2]=z(()=>{},["stop"]))},[o(a(N),null,{default:n(()=>[o(a(Ze))]),_:1}),C(" "+U(p.post.favoritesCount||0),1)]),c[10]||(c[10]=r("span",{class:"spacer"},null,-1)),p.isAuthor?(i(),d(q,{key:0},[o(a(T),{link:"",type:"primary",size:"small",onClick:c[3]||(c[3]=z(w=>h("edit",p.post.id),["stop"])),class:"action-button"},{default:n(()=>[o(a(N),null,{default:n(()=>[o(a(Ge))]),_:1}),c[8]||(c[8]=C(" 编辑 "))]),_:1}),o(a(T),{link:"",type:"danger",size:"small",onClick:c[4]||(c[4]=z(w=>h("delete",p.post.id),["stop"])),class:"action-button"},{default:n(()=>[o(a(N),null,{default:n(()=>[o(a(Qe))]),_:1}),c[9]||(c[9]=C(" 删除 "))]),_:1})],64)):x("",!0),o(a(N),{class:"more-icon",onClick:c[5]||(c[5]=z(()=>{},["stop"]))},{default:n(()=>[o(a(el))]),_:1})])])]}),_:1}))}}),ke=re(_l,[["__scopeId","data-v-810f2900"]]),bl={class:"user-list-item"},Cl={class:"user-details"},$l={class:"user-name"},Fl={key:0,class:"user-bio"},Vl=oe({__name:"UserListItem",props:{user:{type:Object,required:!0},showFollowButton:{type:Boolean,default:!1},isFollowing:{type:Boolean,default:!1},isLoading:{type:Boolean,default:!1}},emits:["toggle-follow"],setup(p,{emit:S}){const P=p,h=E(()=>se(P.user.avatarUrl));return(f,s)=>(i(),d("div",bl,[o(a(ll),{to:{name:"UserProfile",params:{userId:p.user.id}},class:"user-info-link"},{default:n(()=>[o(a(G),{size:40,src:h.value,class:"user-avatar"},null,8,["src"]),r("div",Cl,[r("span",$l,U(p.user.name||p.user.username||"用户"+p.user.id),1),p.user.bio?(i(),d("span",Fl,U(p.user.bio),1)):x("",!0)])]),_:1},8,["to"]),s[0]||(s[0]=r("div",{class:"user-actions"},null,-1))]))}}),_e=re(Vl,[["__scopeId","data-v-a31fadd7"]]),Dl={class:"dialog-footer"},Al=oe({__name:"PostEditModal",props:{visible:{type:Boolean,default:!1},postData:{type:Object,default:null}},emits:["update:visible","post-updated"],setup(p,{emit:S}){const P=p,h=S,f=u(),s=u(!1),$=u(null),y=u({title:"",content:""}),_=u({title:[{required:!0,message:"请输入标题",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}]});te(()=>P.visible,w=>{w&&P.postData&&($.value={...P.postData},y.value.title=P.postData.title||"",y.value.content=P.postData.content||"",$e(()=>{var v;(v=f.value)==null||v.clearValidate()}))});const c=()=>{var w;$.value=null,y.value.title="",y.value.content="",(w=f.value)==null||w.resetFields()},b=async()=>{var w,v;if(!(!f.value||!$.value))try{if(await f.value.validate()){s.value=!0;const M=$.value.id,R={title:y.value.title,content:y.value.content};try{const A=await ae.updatePost(M,R);m.success("帖子更新成功"),h("post-updated",A),h("update:visible",!1)}catch(A){console.error("Failed to update post:",A),m.error(((v=(w=A.response)==null?void 0:w.data)==null?void 0:v.message)||"更新帖子失败")}finally{s.value=!1}}else return console.log("Form validation failed"),!1}catch(V){console.log("Form validation error (catch):",V)}};return(w,v)=>(i(),D(a(Ce),{"model-value":p.visible,title:"编辑帖子",width:"600px","onUpdate:modelValue":v[3]||(v[3]=V=>w.$emit("update:visible",V)),onClosed:c,"close-on-click-modal":!1},{footer:n(()=>[r("span",Dl,[o(a(T),{onClick:v[2]||(v[2]=V=>w.$emit("update:visible",!1))},{default:n(()=>v[4]||(v[4]=[C("取消")])),_:1}),o(a(T),{type:"primary",onClick:b,loading:s.value},{default:n(()=>v[5]||(v[5]=[C(" 保存 ")])),_:1},8,["loading"])])]),default:n(()=>[$.value?tl((i(),D(a(sl),{key:0,ref_key:"editFormRef",ref:f,model:y.value,rules:_.value,"label-width":"80px"},{default:n(()=>[o(a(ne),{label:"标题",prop:"title"},{default:n(()=>[o(a(Ue),{modelValue:y.value.title,"onUpdate:modelValue":v[0]||(v[0]=V=>y.value.title=V),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),o(a(ne),{label:"内容",prop:"content"},{default:n(()=>[o(a(Ue),{modelValue:y.value.content,"onUpdate:modelValue":v[1]||(v[1]=V=>y.value.content=V),type:"textarea",rows:5,placeholder:"请输入内容"},null,8,["modelValue"])]),_:1}),$.value.imageUrl?(i(),D(a(ne),{key:0,label:"图片"},{default:n(()=>[o(a(be),{style:{width:"100px",height:"100px"},src:a(se)($.value.imageUrl),fit:"cover"},null,8,["src"])]),_:1})):x("",!0)]),_:1},8,["model","rules"])),[[a(al),s.value]]):x("",!0)]),_:1},8,["model-value"]))}}),Ll=re(Al,[["__scopeId","data-v-62945969"]]),Bl={key:0,class:"loading-state"},El={key:1,class:"error-state"},xl={key:2,class:"user-profile-view"},Il={class:"profile-banner"},Nl={key:0,class:"edit-icon-overlay"},Tl={class:"profile-info"},Sl={class:"user-bio"},Ml={class:"user-stats"},Rl={key:0,class:"tab-placeholder"},zl={key:1,class:"tab-placeholder"},ql={key:2,class:"post-list"},Wl={key:0,class:"loading-more"},jl={key:0,class:"loading-placeholder"},Ol={key:1,class:"empty-placeholder"},Jl={key:2,class:"post-list"},Hl={key:0,class:"loading-more"},Kl={key:0,class:"loading-placeholder"},Xl={key:1,class:"empty-placeholder"},Yl={key:2,class:"user-list"},Zl={key:0,class:"loading-more"},Gl={key:0,class:"loading-placeholder"},Ql={key:1,class:"empty-placeholder"},et={key:2,class:"user-list"},lt={key:0,class:"loading-more"},tt={key:3,class:"not-found"},at={class:"dialog-content"},st={class:"preview-section"},ot={class:"setting-item avatar-upload-dialog"},rt={class:"setting-item default-avatars"},it={class:"avatar-options"},nt={class:"dialog-footer"},ut=oe({__name:"UserProfileView",setup(p){const S=cl(),P=ol(),h=E(()=>P.params.userId),f=rl(),s=u(null),$=u(!0),y=u(null),_=u("posts"),c=u(!1),b=u([]),w=u(!1),v=u(0),V=u(0),M=u([]),R=u(!1),A=u(0),de=u(0),W=u(!1),I=u(null),Q=u([]),j=u([]),O=u([]),J=u(!1),H=u(!1),K=u(0),X=u(0),ce=u(0),ve=u(0),ee=u({}),ie=u(!1),fe=u(null),L=E(()=>{var e;return f.isLoggedIn&&((e=f.currentUser)==null?void 0:e.id)===Number(h.value)}),pe=E(()=>f.isLoggedIn&&f.currentUser&&f.currentUser.id!==Number(h.value)),Fe=E(()=>{var g;const e=(g=s.value)==null?void 0:g.avatarUrl;let l;if(e&&(e.startsWith("http://")||e.startsWith("https://")))l=e;else{const k=(Pe.defaults.baseURL||"").replace(/\/api\/?$/,""),Y=e||"/avatars/defaults/default_avatar.png",Oe=Y.startsWith("/")?Y:"/"+Y;l=`${k}${Oe}`}const t=`?t=${Date.now()}`;return l.includes("?")?`${l}&${t.substring(1)}`:`${l}${t}`}),Ve=E(()=>B.getUploadAvatarUrl()),De=E(()=>({Authorization:`Bearer ${f.token}`})),ge=e=>{console.log(`[UserProfileView] goToPostDetail triggered with postId: ${e}`),e?(console.log(`[UserProfileView] Preparing to call router.push in nextTick for id: ${e}`),$e(()=>{try{console.log(`[UserProfileView] Executing router.push inside nextTick for PostDetail with id: ${e}`),S.push({name:"PostDetail",params:{id:e}})}catch(l){console.error("[UserProfileView] Error during router.push:",l)}})):console.warn("[UserProfileView] goToPostDetail called with invalid postId:",e)},Ae=e=>{console.log(`[UserProfileView] handleEditPost called for ID: ${e}`);const l=b.value.find(t=>t.id===e);l?(fe.value=l,ie.value=!0):(console.warn(`[UserProfileView] Post with ID ${e} not found for editing.`),m.error("找不到要编辑的帖子"))},Le=async()=>{if(!s.value||!pe.value)return;c.value=!0;const e=Number(h.value);try{s.value.isFollowing?(await B.unfollowUser(e),s.value&&(s.value.isFollowing=!1,s.value.followerCount--),m.success("已取消关注")):(await B.followUser(e),s.value&&(s.value.isFollowing=!0,s.value.followerCount++),m.success("关注成功"))}catch(l){console.error("Follow/Unfollow failed:",l),m.error("操作失败")}finally{c.value=!1}},me=async()=>{try{console.log("[UserProfileView] Calling UserService.getDefaultAvatars...");const e=await B.getDefaultAvatars();console.log("[UserProfileView] Raw response from UserService.getDefaultAvatars():",JSON.stringify(e,null,2)),Q.value=e.avatarUrls,console.log("[UserProfileView] Assigned preset avatars to ref:",Q.value)}catch(e){console.error("[UserProfileView] Failed to fetch preset avatars:",e)}},we=e=>{let l;if(e&&(e.startsWith("http://")||e.startsWith("https://")))l=e;else{const F=(Pe.defaults.baseURL||"").replace(/\/api\/?$/,""),k=e||"/avatars/defaults/default_avatar.png",Y=k.startsWith("/")?k:"/"+k;l=`${F}${Y}`}const t=`?t=${Date.now()}`;return l.includes("?")?`${l}&${t.substring(1)}`:`${l}${t}`},Be=()=>{var e;L.value&&(I.value=((e=f.currentUser)==null?void 0:e.avatarUrl)||null,Q.value.length===0&&me(),W.value=!0)},Ee=(e,l)=>{console.log("[UserProfileView] Avatar Upload Success Response:",e),e&&typeof e.avatarUrl=="string"?(I.value=e.avatarUrl,m.success("头像上传成功! 请点击保存以应用更改。")):(console.error("[UserProfileView] Invalid response from avatar upload:",e),m.error((e==null?void 0:e.message)||"头像上传失败，响应数据无效"))},xe=e=>{const l=e.type.startsWith("image/"),t=e.size/1024/1024<5;return l||m.error("只能上传图片文件!"),t||m.error("图片大小不能超过 5MB!"),l&&t},Ie=async()=>{var t,g,F;const e=((t=f.currentUser)==null?void 0:t.avatarUrl)||null,l=I.value===void 0?null:I.value;if(l===e){W.value=!1;return}console.log("[UserProfileView] Saving avatar selection. New URL to save:",l);try{const k=await B.updateMyProfile({avatarUrl:l});if(console.log("[UserProfileView] Received user data after update:",JSON.stringify(k==null?void 0:k.user,null,2)),k&&k.user)f.setUser(k.user),L.value&&s.value&&(console.log("[UserProfileView] Updating local userData.avatarUrl for sync."),s.value.avatarUrl=k.user.avatarUrl===void 0?null:k.user.avatarUrl),m.success("头像更新成功!"),W.value=!1;else throw new Error("Invalid response after updating profile")}catch(k){console.error("Failed to update avatar:",k),m.error(((F=(g=k.response)==null?void 0:g.data)==null?void 0:F.message)||k.message||"头像更新失败")}},he=async e=>{if(!f.isLoggedIn){m.warning("请先登录"),S.push("/login");return}ee.value[e]=!0;try{const t=(_.value==="following"?j.value:O.value).find(F=>F.id===e);if(!t)return;t.isFollowing?(await B.unfollowUser(e),t.isFollowing=!1,s.value&&s.value.id===e&&(s.value.isFollowing=!1,s.value.followerCount=Math.max(0,(s.value.followerCount??0)-1)),L.value&&s.value&&(s.value.followingCount=Math.max(0,(s.value.followingCount??0)-1)),m.success("已取消关注")):(await B.followUser(e),t.isFollowing=!0,s.value&&s.value.id===e&&(s.value.isFollowing=!0,s.value.followerCount=(s.value.followerCount??0)+1),L.value&&s.value&&(s.value.followingCount=(s.value.followingCount??0)+1),m.success("关注成功"))}catch(l){console.error(`Toggle follow failed for user ${e}:`,l),m.error("操作失败")}finally{ee.value[e]=!1}},Ne=()=>{b.value=[],v.value=0,V.value=0,M.value=[],A.value=0,de.value=0,j.value=[],K.value=0,ce.value=0,O.value=[],X.value=0,ve.value=0},Te=async(e=1,l=!1)=>{if(h.value){w.value=!0;try{const t=await ae.getPostsByUserId(Number(h.value),e,9);l?b.value.push(...t.posts):b.value=t.posts,v.value=t.currentPage,V.value=t.totalPages}catch(t){console.error("Failed to fetch user posts:",t),m.error("加载帖子列表失败")}finally{w.value=!1}}},Se=async(e=1,l=!1)=>{if(h.value){R.value=!0;try{const t=await ae.getFavoritedPosts(Number(h.value),e,9);l?M.value.push(...t.posts):M.value=t.posts,A.value=t.currentPage,de.value=t.totalPages}catch(t){console.error("Failed to fetch user favorites:",t),m.error("加载收藏列表失败")}finally{R.value=!1}}},Me=async(e=1,l=!1)=>{if(h.value){J.value=!0;try{const t=await B.getFollowing(Number(h.value),e,15);l?j.value.push(...t.following||[]):j.value=t.following||[],K.value=t.currentPage,ce.value=t.totalPages}catch(t){console.error("Failed to fetch following list:",t),m.error("加载关注列表失败")}finally{J.value=!1}}},Re=async(e=1,l=!1)=>{if(h.value){H.value=!0;try{const t=await B.getFollowers(Number(h.value),e,15);l?O.value.push(...t.followers||[]):O.value=t.followers||[],X.value=t.currentPage,ve.value=t.totalPages}catch(t){console.error("Failed to fetch followers list:",t),m.error("加载粉丝列表失败")}finally{H.value=!1}}},ye=e=>{switch(console.log(`[UserProfileView] Loading data for tab: ${e}`),e){case"posts":v.value===0&&Te(1);break;case"favorites":A.value===0&&Se(1);break;case"following":K.value===0&&Me(1);break;case"followers":X.value===0&&Re(1);break}},ze=async e=>{var l,t,g;$.value=!0,y.value=null,s.value=null;try{console.log(`[UserProfileView] Fetching profile for user ID: ${e}`),s.value=await B.getUserProfile(e),console.log("[UserProfileView] User profile data fetched:",s.value),_.value="posts",Ne(),ye(_.value)}catch(F){console.error(`[UserProfileView] Error fetching profile for user ${e}:`,F),y.value=((l=F.response)==null?void 0:l.status)===404?"用户不存在。":((g=(t=F.response)==null?void 0:t.data)==null?void 0:g.message)||"加载用户信息时出错"}finally{$.value=!1}};te(h,e=>{if(e){const l=Number(e);isNaN(l)?(console.error(`[UserProfileView] Invalid user ID detected in route: ${e}`),y.value="无效的用户ID",$.value=!1):ze(l)}},{immediate:!0}),te(_,(e,l)=>{e&&e!==l&&(ye(e),S.replace({query:{...P.query,tab:e}}))}),te(()=>P.query.tab,e=>{typeof e=="string"&&["posts","favorites","following","followers"].includes(e)&&e!==_.value&&(_.value=e)});const qe=e=>{var F;if(!e||f.currentUser===null)return!1;const l=Number(e.authorId),t=Number((F=f.currentUser)==null?void 0:F.id);return L.value&&!isNaN(l)&&!isNaN(t)&&l===t},We=async e=>{var l,t;console.log(`[UserProfileView] handleDeletePost called for ID: ${e}`);try{await vl.confirm("确定要永久删除这篇帖子吗？此操作无法撤销。","确认删除",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning"});try{await ae.deletePost(e),b.value=b.value.filter(g=>g.id!==e),s.value&&typeof s.value.postCount=="number"&&(s.value.postCount=Math.max(0,s.value.postCount-1)),m.success("帖子删除成功")}catch(g){console.error(`Failed to delete post ${e}:`,g),m.error(((t=(l=g.response)==null?void 0:l.data)==null?void 0:t.message)||"删除帖子失败")}}catch{m.info("已取消删除")}},je=e=>{console.log("[UserProfileView] handlePostUpdated called with:",e);const l=b.value.findIndex(t=>t.id===e.id);l!==-1?(b.value.splice(l,1,e),m.success("帖子列表已更新")):console.warn("[UserProfileView] Updated post not found in local list, list might be out of sync.")};return il(()=>{me()}),(e,l)=>(i(),d(q,null,[$.value?(i(),d("div",Bl,"加载中...")):y.value?(i(),d("div",El,U(y.value),1)):s.value?(i(),d("div",xl,[r("div",Il,[r("div",{class:ue(["profile-avatar-container",{clickable:L.value}]),onClick:l[0]||(l[0]=t=>L.value?Be():null)},[o(a(G),{size:100,src:Fe.value,class:"profile-avatar"},null,8,["src"]),L.value?(i(),d("div",Nl,[o(a(N),null,{default:n(()=>[o(a(ul))]),_:1})])):x("",!0)],2)]),r("div",Tl,[r("h2",null,U(s.value.name||s.value.username),1),r("p",Sl,U(s.value.bio||"这个人很懒，什么都没留下~"),1),r("div",Ml,[r("span",null,[r("strong",null,U(s.value.postCount??0),1),l[6]||(l[6]=C(" 动态"))]),r("span",null,[r("strong",null,U(s.value.followerCount??0),1),l[7]||(l[7]=C(" 粉丝"))]),r("span",null,[r("strong",null,U(s.value.followingCount??0),1),l[8]||(l[8]=C(" 关注"))]),r("span",null,[r("strong",null,U(s.value.favoritesCount??0),1),l[9]||(l[9]=C(" 收藏"))])]),pe.value?(i(),D(a(T),{key:0,type:s.value.isFollowing?"default":"primary",onClick:Le,loading:c.value},{default:n(()=>[C(U(s.value.isFollowing?"已关注":"关注"),1)]),_:1},8,["type","loading"])):x("",!0)]),o(a(nl),{modelValue:_.value,"onUpdate:modelValue":l[1]||(l[1]=t=>_.value=t),class:"profile-tabs"},{default:n(()=>[o(a(le),{label:"动态",name:"posts"},{default:n(()=>[w.value&&v.value===1?(i(),d("div",Rl,"正在加载帖子...")):!w.value&&b.value.length===0?(i(),d("div",zl,"该用户还没有发布任何动态哦~")):(i(),d("div",ql,[(i(!0),d(q,null,Z(b.value,t=>(i(),D(ke,{key:t.id,post:t,onCardClick:ge,"is-author":qe(t),onDelete:We,onEdit:Ae,class:"profile-post-card"},null,8,["post","is-author"]))),128)),w.value&&v.value>1?(i(),d("div",Wl,"加载更多...")):x("",!0)]))]),_:1}),o(a(le),{label:"收藏",name:"favorites"},{default:n(()=>[R.value&&A.value===1?(i(),d("div",jl,"正在加载收藏...")):!R.value&&M.value.length===0?(i(),d("div",Ol,"该用户还没有收藏任何帖子哦~")):(i(),d("div",Jl,[(i(!0),d(q,null,Z(M.value,t=>(i(),D(ke,{key:`fav-${t.id}`,post:t,onCardClick:ge,class:"profile-post-card"},null,8,["post"]))),128)),R.value&&A.value>1?(i(),d("div",Hl,"加载更多...")):x("",!0)]))]),_:1}),o(a(le),{label:"关注",name:"following"},{default:n(()=>[J.value&&K.value===1?(i(),d("div",Kl,"正在加载关注列表...")):!J.value&&j.value.length===0?(i(),d("div",Xl,U(L.value?"你":"TA")+"还没有关注任何人哦~",1)):(i(),d("div",Yl,[(i(!0),d(q,null,Z(j.value,t=>{var g;return i(),D(_e,{key:t.id,user:t,showFollowButton:a(f).isLoggedIn&&((g=a(f).currentUser)==null?void 0:g.id)!==t.id,isFollowing:t.isFollowing,isLoading:ee.value[t.id]||!1,onToggleFollow:he},null,8,["user","showFollowButton","isFollowing","isLoading"])}),128)),J.value&&K.value>1?(i(),d("div",Zl,"加载更多...")):x("",!0)]))]),_:1}),o(a(le),{label:"粉丝",name:"followers"},{default:n(()=>[H.value&&X.value===1?(i(),d("div",Gl,"正在加载粉丝列表...")):!H.value&&O.value.length===0?(i(),d("div",Ql,U(L.value?"你":"TA")+"还没有粉丝哦~",1)):(i(),d("div",et,[(i(!0),d(q,null,Z(O.value,t=>{var g;return i(),D(_e,{key:t.id,user:t,showFollowButton:a(f).isLoggedIn&&((g=a(f).currentUser)==null?void 0:g.id)!==t.id,isFollowing:t.isFollowing,isLoading:ee.value[t.id]||!1,onToggleFollow:he},null,8,["user","showFollowButton","isFollowing","isLoading"])}),128)),H.value&&X.value>1?(i(),d("div",lt,"加载更多...")):x("",!0)]))]),_:1})]),_:1},8,["modelValue"])])):(i(),d("div",tt,"用户不存在。")),o(a(Ce),{modelValue:W.value,"onUpdate:modelValue":l[4]||(l[4]=t=>W.value=t),title:"修改头像",width:"500px",class:"avatar-dialog"},{footer:n(()=>[r("span",nt,[o(a(T),{onClick:l[3]||(l[3]=t=>W.value=!1)},{default:n(()=>l[16]||(l[16]=[C("取消")])),_:1}),o(a(T),{type:"primary",onClick:Ie},{default:n(()=>l[17]||(l[17]=[C("保存")])),_:1})])]),default:n(()=>[r("div",at,[r("div",st,[l[10]||(l[10]=r("label",null,"预览",-1)),o(a(G),{size:120,src:we(I.value)},null,8,["src"])]),r("div",ot,[l[13]||(l[13]=r("label",null,"上传新头像",-1)),o(a(dl),{class:"avatar-uploader-dialog",action:Ve.value,"show-file-list":!1,headers:De.value,"on-success":Ee,"before-upload":xe,name:"avatar"},{tip:n(()=>l[12]||(l[12]=[r("div",{class:"el-upload__tip"}," 只能上传 jpg/png 文件，且不超过 5MB ",-1)])),default:n(()=>[o(a(T),{type:"primary"},{default:n(()=>l[11]||(l[11]=[C("点击上传")])),_:1})]),_:1},8,["action","headers"])]),r("div",rt,[l[15]||(l[15]=r("label",null,"选择预设头像",-1)),r("div",it,[(i(!0),d(q,null,Z(Q.value,t=>(i(),D(a(G),{key:t,size:60,src:we(t),onClick:g=>I.value=t,class:ue(["preset-avatar",{selected:I.value===t}])},null,8,["src","onClick","class"]))),128)),o(a(T),{text:"",onClick:l[2]||(l[2]=t=>I.value=null),class:ue(["preset-avatar remove-avatar-btn",{selected:I.value===null}])},{default:n(()=>l[14]||(l[14]=[C("移除头像")])),_:1},8,["class"])])])])]),_:1},8,["modelValue"]),o(Ll,{visible:ie.value,"onUpdate:visible":l[5]||(l[5]=t=>ie.value=t),"post-data":fe.value,onPostUpdated:je},null,8,["visible","post-data"])],64))}}),ct=re(ut,[["__scopeId","data-v-247c1432"]]);export{ct as default};
