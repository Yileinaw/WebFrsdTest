import{d as B,F as D,r as v,G as c,H as R,y as a,a as r,u as s,I as q,w as i,J as H,K as j,e as w,t as C,L as G,M as z,D as l,_ as L,N as J,o as K,R as V,c as m,q as g,O,v as $,P as F,h as P,Q as I,S as x,T as Q,U as W,V as X,W as Y,A as Z}from"./index-B8L1PXQk.js";import{_ as S}from"./default-food-DJ8mVkvR.js";import{g as A}from"./imageUrl-B7VLit5q.js";import{A as ee}from"./AdminService-D7bLfGG4.js";const se={class:"card-image-container"},te={class:"image-slot-placeholder"},oe={class:"card-content-container"},ae={key:0,class:"card-description"},le={key:1,class:"card-description placeholder"},re={key:2,class:"author-info"},ie={class:"author-name"},ne=300,ce=B({__name:"FoodCard",props:{post:{}},setup(E){const o=E;D(()=>{const _=o.post.imageUrl;A(_)});const f=z(),h=v(!1),u=()=>{h.value||(h.value=!0,setTimeout(()=>{try{"author"in o.post?f.push(`/posts/${o.post.id}`):f.push({path:"/discover",hash:`#showcase-${o.post.id}`})}finally{setTimeout(()=>{h.value=!1},50)}},ne))};return(_,p)=>{var n,y;return l(),c("div",{class:R(["food-card",{"is-clicked":h.value}]),onClick:u},[a("div",se,[r(s(q),{src:s(A)(o.post.imageUrl)||s(S),alt:o.post.title,fit:"cover",class:"food-image"},{error:i(()=>[a("div",te,[r(s(H),null,{default:i(()=>[r(s(j))]),_:1})])]),placeholder:i(()=>p[0]||(p[0]=[a("div",{class:"image-slot-placeholder"},"加载中...",-1)])),_:1},8,["src","alt"])]),a("div",oe,[a("h4",null,C(o.post.title),1),"description"in o.post&&o.post.description?(l(),c("p",ae,C(o.post.description),1)):"description"in o.post?(l(),c("p",le)):w("",!0),"author"in o.post&&o.post.author?(l(),c("div",re,[r(s(G),{size:24,src:s(A)((n=o.post.author)==null?void 0:n.avatarUrl)||s(S),class:"author-avatar"},null,8,["src"]),a("span",ie,C(((y=o.post.author)==null?void 0:y.name)||"匿名用户"),1)])):w("",!0)])],2)}}}),U=L(ce,[["__scopeId","data-v-4c77781e"]]),ue={class:"home-view"},de={class:"hero-section"},pe={class:"hero-content container"},me={class:"featured-section container"},ve={class:"section-header"},fe={key:0,class:"loading-indicator"},he=["onClick"],_e={class:"latest-section container"},ye={class:"section-header"},ge={class:"header-actions"},we={key:0,class:"loading-indicator"},ke={key:1,class:"latest-posts-list vertical-list"},Ce=B({__name:"HomeView",setup(E){function o(e){for(let t=e.length-1;t>0;t--){const d=Math.floor(Math.random()*(t+1));[e[t],e[d]]=[e[d],e[t]]}return e}const f=z(),h=J(),u=v([]),_=v(!1),p=v(null),n=v([]),y=v(!1),k=v(null),M=()=>{if(!h.isLoggedIn){Z.warning("请先登录再发布帖子"),f.push("/login");return}f.push({name:"CreatePost"})},N=e=>{e&&f.push({path:"/discover",hash:`#showcase-${e}`})},T=async()=>{_.value=!0,p.value=null;try{console.log("[HomeView] 开始获取特色帖子...");const e=await ee.getFoodShowcases({page:1,limit:12});if(console.log("[HomeView] 获取特色帖子响应:",e),e&&e.items&&Array.isArray(e.items))u.value=o([...e.items]).slice(0,6),console.log("[HomeView] 处理后的特色帖子:",u.value);else if(e&&Array.isArray(e))u.value=o([...e]).slice(0,6),console.log("[HomeView] 处理后的特色帖子(数组响应):",u.value);else throw console.error("[HomeView] 无法处理的响应格式:",e),new Error("响应格式不符合预期")}catch(e){console.error("[HomeView] Failed to fetch featured posts:",e),p.value="加载热门推荐失败",u.value=[]}finally{_.value=!1}},b=async()=>{y.value=!0,k.value=null;try{console.log("[HomeView] 开始获取最新社区帖子...");const e=await Q.getAllPosts({sortBy:"createdAt",limit:4});if(console.log("[HomeView] 获取最新社区帖子响应:",e),e&&e.posts&&Array.isArray(e.posts))n.value=e.posts,console.log("[HomeView] 处理后的最新社区帖子:",n.value);else if(e&&Array.isArray(e))n.value=e,console.log("[HomeView] 处理后的最新社区帖子(数组响应):",n.value);else throw console.error("[HomeView] 无法处理的响应格式:",e),new Error("响应格式不符合预期")}catch(e){console.error("[HomeView] Failed to fetch latest community posts:",e),k.value="加载最新分享失败",n.value=[]}finally{y.value=!1}};return K(()=>{T(),b()}),(e,t)=>(l(),c("div",ue,[a("section",de,[a("div",pe,[t[1]||(t[1]=a("h1",null,"探索舌尖上的世界",-1)),t[2]||(t[2]=a("p",null,"发现、分享、品味生活中的每一道佳肴",-1)),r(s(V),{to:"/discover",class:"hero-button-link"},{default:i(()=>[r(s(P),{type:"primary",size:"large"},{default:i(()=>t[0]||(t[0]=[g("立即探索美食")])),_:1})]),_:1})])]),a("section",me,[a("div",ve,[a("h2",null,[r(s(H),null,{default:i(()=>[r(s(W))]),_:1}),t[3]||(t[3]=g(" 热门推荐"))]),r(s(V),{to:"/discover?filter=featured",class:"view-more-link"},{default:i(()=>t[4]||(t[4]=[g("查看更多推荐 >")])),_:1})]),_.value?(l(),c("div",fe,"加载中...")):u.value.length>0?(l(),m(s(O),{key:1,interval:5e3,type:"card",height:"350px",arrow:"always","indicator-position":"none",class:"featured-carousel"},{default:i(()=>[(l(!0),c(I,null,x(u.value,d=>(l(),m(s(X),{key:d.id},{default:i(()=>[a("div",{class:"carousel-card-wrapper",onClick:Ve=>N(d.id)},[r(U,{post:d,class:"featured-post-card"},null,8,["post"])],8,he)]),_:2},1024))),128))]),_:1})):p.value?w("",!0):(l(),m(s($),{key:2,description:"暂无热门推荐"})),p.value?(l(),m(s(F),{key:3,title:p.value,type:"error","show-icon":"",closable:!1},null,8,["title"])):w("",!0)]),a("section",_e,[a("div",ye,[a("h2",null,[r(s(H),null,{default:i(()=>[r(s(Y))]),_:1}),t[5]||(t[5]=g(" 最新分享"))]),a("div",ge,[r(s(P),{type:"primary",size:"small",onClick:M},{default:i(()=>t[6]||(t[6]=[g("发布帖子")])),_:1}),r(s(V),{to:"/community",class:"view-more-link"},{default:i(()=>t[7]||(t[7]=[g("进入社区 >")])),_:1})])]),y.value?(l(),c("div",we,"加载中...")):n.value.length>0?(l(),c("div",ke,[(l(!0),c(I,null,x(n.value,d=>(l(),m(U,{key:d.id,post:d,class:"latest-post-card horizontal-layout"},null,8,["post"]))),128))])):k.value?w("",!0):(l(),m(s($),{key:2,description:"暂无最新分享"})),k.value?(l(),m(s(F),{key:3,title:k.value,type:"error","show-icon":"",closable:!1},null,8,["title"])):w("",!0)])]))}}),Fe=L(Ce,[["__scopeId","data-v-0b400588"]]);export{Fe as default};
