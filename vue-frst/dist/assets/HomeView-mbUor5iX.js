import{d as B,w as N,r as m,c as i,o,n as S,a,b as r,u as e,E as L,e as n,f as $,p as M,g as h,t as C,h as R,i as T,_ as U,j,R as E,k as p,l as g,m as q,q as x,s as A,F as V,v as P,P as D,x as G,y as J,z as K,A as O}from"./index-u3ChIZEC.js";import{_ as I}from"./default-food-DJ8mVkvR.js";import{g as F}from"./imageUrl-Wr3USPEb.js";import{A as Q}from"./AdminService-DpEl2DRV.js";const W={class:"card-image-container"},X={class:"image-slot-placeholder"},Y={class:"card-content-container"},Z={key:0,class:"card-description"},ee={key:1,class:"card-description placeholder"},te={key:2,class:"author-info"},se={class:"author-name"},oe=300,ae=B({__name:"FoodCard",props:{post:{}},setup(b){const s=b;N(()=>{const f=s.post.imageUrl;F(f)});const _=T(),c=m(!1),d=()=>{c.value||(c.value=!0,setTimeout(()=>{try{"author"in s.post?_.push(`/posts/${s.post.id}`):_.push({path:"/discover",hash:`#showcase-${s.post.id}`})}finally{setTimeout(()=>{c.value=!1},50)}},oe))};return(f,v)=>{var u,k;return o(),i("div",{class:S(["food-card",{"is-clicked":c.value}]),onClick:d},[a("div",W,[r(e(L),{src:e(F)(s.post.imageUrl)||e(I),alt:s.post.title,fit:"cover",class:"food-image"},{error:n(()=>[a("div",X,[r(e($),null,{default:n(()=>[r(e(M))]),_:1})])]),placeholder:n(()=>v[0]||(v[0]=[a("div",{class:"image-slot-placeholder"},"加载中...",-1)])),_:1},8,["src","alt"])]),a("div",Y,[a("h4",null,C(s.post.title),1),"description"in s.post&&s.post.description?(o(),i("p",Z,C(s.post.description),1)):"description"in s.post?(o(),i("p",ee)):h("",!0),"author"in s.post&&s.post.author?(o(),i("div",te,[r(e(R),{size:24,src:e(F)((u=s.post.author)==null?void 0:u.avatarUrl)||e(I),class:"author-avatar"},null,8,["src"]),a("span",se,C(((k=s.post.author)==null?void 0:k.name)||"匿名用户"),1)])):h("",!0)])],2)}}}),z=U(ae,[["__scopeId","data-v-4c77781e"]]),le={class:"home-view"},re={class:"hero-section"},ne={class:"hero-content container"},ie={class:"featured-section container"},ce={class:"section-header"},ue={key:0,class:"loading-indicator"},de={class:"carousel-card-wrapper"},pe={class:"latest-section container"},me={class:"section-header"},_e={key:0,class:"loading-indicator"},fe={key:1,class:"latest-posts-list vertical-list"},ve=B({__name:"HomeView",setup(b){function s(l){for(let t=l.length-1;t>0;t--){const w=Math.floor(Math.random()*(t+1));[l[t],l[w]]=[l[w],l[t]]}return l}const _=m([]),c=m(!1),d=m(null),f=m([]),v=m(!1),u=m(null),k=async()=>{c.value=!0,d.value=null;try{const l=await Q.getFoodShowcases({page:1,limit:12});_.value=s([...l.items]).slice(0,6)}catch(l){console.error("[HomeView] Failed to fetch featured posts:",l),d.value="加载热门推荐失败"}finally{c.value=!1}},H=async()=>{v.value=!0,u.value=null;try{const l=await D.getAllPosts({sortBy:"createdAt",limit:4});f.value=l.posts}catch(l){console.error("[HomeView] Failed to fetch latest community posts:",l),u.value="加载最新分享失败"}finally{v.value=!1}};return j(()=>{k(),H()}),(l,t)=>{const w=G("el-button");return o(),i("div",le,[a("section",re,[a("div",ne,[t[1]||(t[1]=a("h1",null,"探索舌尖上的世界",-1)),t[2]||(t[2]=a("p",null,"发现、分享、品味生活中的每一道佳肴",-1)),r(e(E),{to:"/discover",class:"hero-button-link"},{default:n(()=>[r(w,{type:"primary",size:"large"},{default:n(()=>t[0]||(t[0]=[g("立即探索美食")])),_:1})]),_:1})])]),a("section",ie,[a("div",ce,[a("h2",null,[r(e($),null,{default:n(()=>[r(e(J))]),_:1}),t[3]||(t[3]=g(" 热门推荐"))]),r(e(E),{to:"/discover?filter=featured",class:"view-more-link"},{default:n(()=>t[4]||(t[4]=[g("查看更多推荐 >")])),_:1})]),c.value?(o(),i("div",ue,"加载中...")):_.value.length>0?(o(),p(e(q),{key:1,interval:5e3,type:"card",height:"350px",arrow:"always","indicator-position":"none",class:"featured-carousel"},{default:n(()=>[(o(!0),i(V,null,P(_.value,y=>(o(),p(e(K),{key:y.id},{default:n(()=>[a("div",de,[r(z,{post:y,class:"featured-post-card"},null,8,["post"])])]),_:2},1024))),128))]),_:1})):d.value?h("",!0):(o(),p(e(x),{key:2,description:"暂无热门推荐"})),d.value?(o(),p(e(A),{key:3,title:d.value,type:"error","show-icon":"",closable:!1},null,8,["title"])):h("",!0)]),a("section",pe,[a("div",me,[a("h2",null,[r(e($),null,{default:n(()=>[r(e(O))]),_:1}),t[5]||(t[5]=g(" 最新分享"))]),r(e(E),{to:"/community",class:"view-more-link"},{default:n(()=>t[6]||(t[6]=[g("进入社区 >")])),_:1})]),v.value?(o(),i("div",_e,"加载中...")):f.value.length>0?(o(),i("div",fe,[(o(!0),i(V,null,P(f.value,y=>(o(),p(z,{key:y.id,post:y,class:"latest-post-card horizontal-layout"},null,8,["post"]))),128))])):u.value?h("",!0):(o(),p(e(x),{key:2,description:"暂无最新分享"})),u.value?(o(),p(e(A),{key:3,title:u.value,type:"error","show-icon":"",closable:!1},null,8,["title"])):h("",!0)])])}}}),we=U(ve,[["__scopeId","data-v-bba11dfd"]]);export{we as default};
