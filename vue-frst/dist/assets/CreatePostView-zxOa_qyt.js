import{d as J,N as Q,r as p,X as I,Y as W,o as X,A as m,M as Y,G as d,y as a,a as r,w as n,u as l,h as C,e as k,ak as $,t as h,I as P,Q as R,S as L,ah as H,q as g,ai as b,f as B,c as y,J as K,at as Z,aj as ee,p as T,j as te,i as le,D as s,T as ae,_ as se}from"./index-B8L1PXQk.js";const oe={class:"create-post-view"},re={class:"page-header"},ne={class:"container"},ie={class:"header-content"},ue={class:"actions"},de={class:"container"},ce={class:"post-editor-container"},ve={key:0,class:"image-preview"},pe={key:2,class:"upload-error"},me={key:1,style:{"font-size":"12px",color:"#909399","margin-left":"10px","vertical-align":"top"}},ge={key:0,class:"preview-section"},fe={class:"preview-content"},_e={key:0,class:"preview-image"},we={class:"preview-text"},he={key:1,class:"preview-tags"},ye=J({__name:"CreatePostView",setup(ke){const x=Y(),j=Q(),E=p(),c=I({title:"",content:""}),f=p(null),i=p(null),_=p(null),u=p([]),F=p([]),S=W(()=>F.value.filter(o=>o.isFixed===!0)),M=async()=>{try{const o=await H.get("/tags");F.value=Array.isArray(o.data)?o.data:[]}catch{m.error("获取可用标签列表失败")}},V=p(!1),A=p(!1),D=I({title:[{required:!0,message:"请输入标题",trigger:"blur"},{min:1,max:100,message:"标题长度应在1-100个字符之间",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"},{min:1,max:5e3,message:"内容长度应在1-5000个字符之间",trigger:"blur"}]}),N=()=>{x.back()},z=(o,e)=>{_.value=null;const t=o.raw;if(!t){_.value="无法获取原始文件，请重试。",e.length>0&&(e[e.length-1].uid,o.uid);return}const v=t.type.startsWith("image/"),U=t.size/1024/1024<5;if(!v){m.error("请上传图片格式文件!");return}if(!U){m.error("图片大小不能超过 5MB!");return}f.value=t;try{i.value&&URL.revokeObjectURL(i.value);const w=URL.createObjectURL(t);i.value=w}catch(w){console.error("Error creating object URL:",w),_.value="生成图片预览失败",f.value=null,i.value=null}},O=()=>{i.value&&URL.revokeObjectURL(i.value),f.value=null,i.value=null},q=o=>{u.value=u.value.filter(e=>e!==o)},G=async()=>{var o,e;if(E.value)try{if(!await E.value.validate())return;V.value=!0;const v=new FormData;v.append("title",c.title),v.append("content",c.content),u.value.length>0&&u.value.forEach(w=>{v.append("tags",w)}),f.value&&v.append("image",f.value);const U=await ae.createPost(v);m.success("发布成功!"),x.push({name:"PostDetail",params:{id:U.post.id}})}catch(t){console.error("Failed to create post:",t),m.error(((e=(o=t.response)==null?void 0:o.data)==null?void 0:e.message)||"发布失败")}finally{V.value=!1}};return X(()=>{j.isLoggedIn||(m.warning("请先登录再发布帖子"),x.push("/login")),M()}),(o,e)=>(s(),d("div",oe,[a("div",re,[a("div",ne,[a("div",ie,[e[5]||(e[5]=a("h1",null,"发布新帖子",-1)),a("div",ue,[r(l(C),{onClick:N},{default:n(()=>e[3]||(e[3]=[g("取消")])),_:1}),r(l(C),{type:"primary",onClick:G,loading:V.value},{default:n(()=>e[4]||(e[4]=[g("发布")])),_:1},8,["loading"])])])])]),a("div",de,[a("div",ce,[r(l($),{ref_key:"postFormRef",ref:E,model:c,rules:D,"label-position":"top",class:"post-form"},{default:n(()=>[r(l(b),{label:"标题",prop:"title"},{default:n(()=>[r(l(B),{modelValue:c.title,"onUpdate:modelValue":e[0]||(e[0]=t=>c.title=t),placeholder:"给你的分享起个响亮的标题吧",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),r(l(b),{label:"内容",prop:"content"},{default:n(()=>[r(l(B),{type:"textarea",rows:10,modelValue:c.content,"onUpdate:modelValue":e[1]||(e[1]=t=>c.content=t),placeholder:"分享你的美食故事、食谱或探店心得...",maxlength:"5000","show-word-limit":""},null,8,["modelValue"])]),_:1}),r(l(b),{label:"封面图片"},{default:n(()=>[i.value?(s(),d("div",ve,[r(l(P),{src:i.value,fit:"contain",style:{width:"100%","max-height":"300px",border:"1px solid #eee"},"preview-src-list":[i.value],"preview-teleported":"","hide-on-click-modal":""},null,8,["src","preview-src-list"]),r(l(C),{type:"danger",onClick:O},{default:n(()=>e[6]||(e[6]=[g("移除图片")])),_:1})])):(s(),y(l(ee),{key:1,class:"image-uploader",action:"","show-file-list":!1,onChange:z,accept:"image/*","auto-upload":!1,drag:""},{tip:n(()=>e[7]||(e[7]=[a("div",{class:"el-upload__tip"}," 可选，仅限jpg/png格式，大小不超过5MB ",-1)])),default:n(()=>[r(l(K),{class:"el-icon--upload"},{default:n(()=>[r(l(Z))]),_:1}),e[8]||(e[8]=a("div",{class:"el-upload__text"},[g("拖拽图片到此处，或 "),a("em",null,"点击上传")],-1))]),_:1})),_.value?(s(),d("div",pe,h(_.value),1)):k("",!0)]),_:1}),r(l(b),{label:"标签"},{default:n(()=>[(s(!0),d(R,null,L(u.value,t=>(s(),y(l(T),{key:t,closable:"",onClose:v=>q(t),class:"tag-item"},{default:n(()=>[g(h(t),1)]),_:2},1032,["onClose"]))),128)),u.value.length<5?(s(),y(l(le),{key:0,modelValue:u.value,"onUpdate:modelValue":e[2]||(e[2]=t=>u.value=t),multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"选择预设标签或创建新标签",size:"small",style:{width:"240px","margin-left":"10px","vertical-align":"top"},class:"tag-select-create-view"},{default:n(()=>[(s(!0),d(R,null,L(S.value,t=>(s(),y(l(te),{key:t.id,label:t.name,value:t.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(s(),d("span",me,"最多添加5个标签")),e[9]||(e[9]=a("div",{class:"tag-tip"},"添加标签可以让更多人发现你的帖子",-1))]),_:1})]),_:1},8,["model","rules"]),A.value?(s(),d("div",ge,[e[10]||(e[10]=a("h2",null,"预览",-1)),a("div",fe,[a("h3",null,h(c.title||"标题预览"),1),i.value?(s(),d("div",_e,[r(l(P),{src:i.value,fit:"cover"},null,8,["src"])])):k("",!0),a("div",we,h(c.content||"内容预览"),1),u.value.length>0?(s(),d("div",he,[(s(!0),d(R,null,L(u.value,t=>(s(),y(l(T),{key:t,size:"small"},{default:n(()=>[g(h(t),1)]),_:2},1024))),128))])):k("",!0)])])):k("",!0)])])]))}}),xe=se(ye,[["__scopeId","data-v-743072c6"]]);export{xe as default};
