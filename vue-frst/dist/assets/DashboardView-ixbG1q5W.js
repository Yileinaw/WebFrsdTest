import{d as X,aQ as Z,aR as j,aS as tt,aT as et,aU as at,aV as st,aW as lt,aX as ot,r as T,N as rt,Y as I,o as nt,G as dt,y as l,c as f,e as k,w as e,u as t,k as A,aY as it,P as ut,a,aZ as ct,h as N,a7 as vt,E as D,q as $,z as E,t as x,H as M,J as h,a_ as O,a$ as R,K as pt,aC as ft,ax as ht,U as gt,b0 as mt,b1 as L,m as _t,n as V,p as wt,M as yt,D as v,_ as bt}from"./index-B8L1PXQk.js";import{A as xt}from"./AdminService-D7bLfGG4.js";import{E as W}from"./index-B66TK2sC.js";const kt={class:"dashboard-view"},St={class:"mt-2"},Dt={class:"refresh-container"},$t={class:"card-header"},Ct={class:"card-content"},Et={class:"stat-value"},Tt={class:"card-header"},Vt={class:"card-content"},zt={class:"stat-value"},At={class:"card-header"},Mt={class:"card-content"},Ot={class:"stat-value"},Rt={class:"card-header"},Bt={class:"card-content"},Nt={class:"stat-value"},Lt={class:"chart-container"},Ut={class:"chart-container"},Ft=3,Gt=X({__name:"DashboardView",setup(It){const Y=i=>{const s=new Date(i),r=s.getFullYear(),n=String(s.getMonth()+1).padStart(2,"0"),u=String(s.getDate()).padStart(2,"0"),d=String(s.getHours()).padStart(2,"0"),c=String(s.getMinutes()).padStart(2,"0");return`${r}-${n}-${u} ${d}:${c}`};Z([j,tt,et,at,st,lt,ot]);const U=yt(),C=T(!0),S=T(""),o=T(null),z=T("all"),H=!1,P=T(!1);rt();const F=async()=>{C.value=!0;try{const i=await xt.getDashboardStats();o.value=i,console.log("Dashboard stats:",o.value),S.value=""}catch(i){console.error("Error fetching dashboard stats:",i),S.value=i.message||"获取仪表盘数据失败",o.value={showcases:{total:0,growth:0},users:{total:0,growth:0},posts:{total:0,growth:0},favorites:{total:0,growth:0},contentTrend:[],tagDistribution:[],recentContent:[]}}finally{C.value=!1}},q=I(()=>{var u;const i=((u=o.value)==null?void 0:u.contentTrend)||[],s=i.map(d=>d.date),r=i.map(d=>d.showcases),n=i.map(d=>d.posts);return{tooltip:{trigger:"axis"},legend:{data:["美食图片","帖子"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:s},yAxis:{type:"value"},series:[{name:"美食图片",type:"line",data:r,smooth:!0,lineStyle:{width:3,color:"#1890ff"},itemStyle:{color:"#1890ff"}},{name:"帖子",type:"line",data:n,smooth:!0,lineStyle:{width:3,color:"#52c41a"},itemStyle:{color:"#52c41a"}}]}}),J=I(()=>{if(!o.value||!o.value.tagDistribution)return{title:{text:"加载中...",left:"center",top:"center"},series:[]};const i=o.value.tagDistribution||[];let s=[];return z.value==="food"?s=i.filter(r=>r.type==="FOOD"):z.value==="post"?s=i.filter(r=>r.type==="POST"):s=i,s.length===0?{title:{text:"暂无数据",left:"center",top:"center",textStyle:{color:"#909399",fontSize:14}},tooltip:{},legend:{},series:[]}:{tooltip:{trigger:"item",formatter:r=>{const{name:n,value:u,percent:d,data:c}=r,p=c.type==="FOOD"?"美食":"帖子";return`${n} (${p})<br/>数量: ${u} (${d}%)`}},legend:{type:"scroll",bottom:10,data:s.map(r=>r.name)},series:[{name:"标签分布",type:"pie",radius:["45%","65%"],center:["50%","45%"],avoidLabelOverlap:!1,label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"14",fontWeight:"bold"}},labelLine:{show:!1},data:s.map(r=>({name:r.name,value:r.count,type:r.type}))}]}}),K=i=>{i.type==="post"?U.push(`/posts/${i.id}`):U.push(`/discover?id=${i.id}`)},Q=async()=>{},B=T(0),G=async()=>{try{await F()}catch{B.value<Ft&&(B.value++,console.log(`重试获取仪表盘数据 (第${B.value}次)`),setTimeout(G,1e3))}};return nt(()=>{G()}),(i,s)=>(v(),dt("div",kt,[s[15]||(s[15]=l("h2",{class:"page-title"},"仪表盘",-1)),C.value?(v(),f(t(A),{key:0,class:"loading-container"},{default:e(()=>[a(t(D),{span:24,class:"loading-col"},{default:e(()=>[a(t(vt),{rows:10,animated:""})]),_:1})]),_:1})):k("",!0),S.value?(v(),f(t(ut),{key:1,title:S.value,type:"error","show-icon":"",closable:!1,class:"error-alert"},it({_:2},[t(H)&&S.value.includes("权限不足")?{name:"default",fn:e(()=>[l("div",St,[a(t(N),{type:"primary",size:"small",onClick:Q,loading:P.value},{default:e(()=>s[1]||(s[1]=[$(" 设置为管理员 ")])),_:1},8,["loading"]),s[2]||(s[2]=l("p",{class:"text-xs mt-1"},"注意：此功能仅在开发环境下可用",-1))])]),key:"0"}:void 0]),1032,["title"])):k("",!0),l("div",Dt,[a(t(N),{type:"primary",icon:t(ct),loading:C.value,onClick:F},{default:e(()=>s[3]||(s[3]=[$(" 刷新数据 ")])),_:1},8,["icon","loading"])]),!C.value&&!S.value?(v(),f(t(A),{key:2,gutter:20,class:"stat-cards"},{default:e(()=>[a(t(D),{xs:24,sm:12,md:6,lg:6,xl:6},{default:e(()=>[a(t(E),{shadow:"hover",class:"stat-card"},{header:e(()=>[l("div",$t,[a(t(h),null,{default:e(()=>[a(t(pt))]),_:1}),s[4]||(s[4]=l("span",null,"美食图片",-1))])]),default:e(()=>{var r,n,u,d,c,p,g,m,_,w,y,b;return[l("div",Ct,[l("div",Et,x(((n=(r=o.value)==null?void 0:r.showcases)==null?void 0:n.total)||0),1),l("div",{class:M(["stat-trend",{positive:(((d=(u=o.value)==null?void 0:u.showcases)==null?void 0:d.growth)||0)>0,negative:(((p=(c=o.value)==null?void 0:c.showcases)==null?void 0:p.growth)||0)<0}])},[(((m=(g=o.value)==null?void 0:g.showcases)==null?void 0:m.growth)||0)>0?(v(),f(t(h),{key:0},{default:e(()=>[a(t(O))]),_:1})):(((w=(_=o.value)==null?void 0:_.showcases)==null?void 0:w.growth)||0)<0?(v(),f(t(h),{key:1},{default:e(()=>[a(t(R))]),_:1})):k("",!0),l("span",null,x(Math.abs(((b=(y=o.value)==null?void 0:y.showcases)==null?void 0:b.growth)||0))+"%",1)],2)])]}),_:1})]),_:1}),a(t(D),{xs:24,sm:12,md:6,lg:6,xl:6},{default:e(()=>[a(t(E),{shadow:"hover",class:"stat-card"},{header:e(()=>[l("div",Tt,[a(t(h),null,{default:e(()=>[a(t(ft))]),_:1}),s[5]||(s[5]=l("span",null,"帖子",-1))])]),default:e(()=>{var r,n,u,d,c,p,g,m,_,w,y,b;return[l("div",Vt,[l("div",zt,x(((n=(r=o.value)==null?void 0:r.posts)==null?void 0:n.total)||0),1),l("div",{class:M(["stat-trend",{positive:(((d=(u=o.value)==null?void 0:u.posts)==null?void 0:d.growth)||0)>0,negative:(((p=(c=o.value)==null?void 0:c.posts)==null?void 0:p.growth)||0)<0}])},[(((m=(g=o.value)==null?void 0:g.posts)==null?void 0:m.growth)||0)>0?(v(),f(t(h),{key:0},{default:e(()=>[a(t(O))]),_:1})):(((w=(_=o.value)==null?void 0:_.posts)==null?void 0:w.growth)||0)<0?(v(),f(t(h),{key:1},{default:e(()=>[a(t(R))]),_:1})):k("",!0),l("span",null,x(Math.abs(((b=(y=o.value)==null?void 0:y.posts)==null?void 0:b.growth)||0))+"%",1)],2)])]}),_:1})]),_:1}),a(t(D),{xs:24,sm:12,md:6,lg:6,xl:6},{default:e(()=>[a(t(E),{shadow:"hover",class:"stat-card"},{header:e(()=>[l("div",At,[a(t(h),null,{default:e(()=>[a(t(ht))]),_:1}),s[6]||(s[6]=l("span",null,"用户",-1))])]),default:e(()=>{var r,n,u,d,c,p,g,m,_,w,y,b;return[l("div",Mt,[l("div",Ot,x(((n=(r=o.value)==null?void 0:r.users)==null?void 0:n.total)||0),1),l("div",{class:M(["stat-trend",{positive:(((d=(u=o.value)==null?void 0:u.users)==null?void 0:d.growth)||0)>0,negative:(((p=(c=o.value)==null?void 0:c.users)==null?void 0:p.growth)||0)<0}])},[(((m=(g=o.value)==null?void 0:g.users)==null?void 0:m.growth)||0)>0?(v(),f(t(h),{key:0},{default:e(()=>[a(t(O))]),_:1})):(((w=(_=o.value)==null?void 0:_.users)==null?void 0:w.growth)||0)<0?(v(),f(t(h),{key:1},{default:e(()=>[a(t(R))]),_:1})):k("",!0),l("span",null,x(Math.abs(((b=(y=o.value)==null?void 0:y.users)==null?void 0:b.growth)||0))+"%",1)],2)])]}),_:1})]),_:1}),a(t(D),{xs:24,sm:12,md:6,lg:6,xl:6},{default:e(()=>[a(t(E),{shadow:"hover",class:"stat-card"},{header:e(()=>[l("div",Rt,[a(t(h),null,{default:e(()=>[a(t(gt))]),_:1}),s[7]||(s[7]=l("span",null,"收藏",-1))])]),default:e(()=>{var r,n,u,d,c,p,g,m,_,w,y,b;return[l("div",Bt,[l("div",Nt,x(((n=(r=o.value)==null?void 0:r.favorites)==null?void 0:n.total)||0),1),l("div",{class:M(["stat-trend",{positive:(((d=(u=o.value)==null?void 0:u.favorites)==null?void 0:d.growth)||0)>0,negative:(((p=(c=o.value)==null?void 0:c.favorites)==null?void 0:p.growth)||0)<0}])},[(((m=(g=o.value)==null?void 0:g.favorites)==null?void 0:m.growth)||0)>0?(v(),f(t(h),{key:0},{default:e(()=>[a(t(O))]),_:1})):(((w=(_=o.value)==null?void 0:_.favorites)==null?void 0:w.growth)||0)<0?(v(),f(t(h),{key:1},{default:e(()=>[a(t(R))]),_:1})):k("",!0),l("span",null,x(Math.abs(((b=(y=o.value)==null?void 0:y.favorites)==null?void 0:b.growth)||0))+"%",1)],2)])]}),_:1})]),_:1})]),_:1})):k("",!0),!C.value&&!S.value?(v(),f(t(A),{key:3,gutter:20,class:"chart-row"},{default:e(()=>[a(t(D),{xs:24,sm:24,md:12,lg:12,xl:12},{default:e(()=>[a(t(E),{shadow:"hover",class:"chart-card"},{header:e(()=>s[8]||(s[8]=[l("div",{class:"card-header"},[l("span",null,"内容趋势")],-1)])),default:e(()=>[l("div",Lt,[a(t(W),{class:"chart",option:q.value,autoresize:""},null,8,["option"])])]),_:1})]),_:1}),a(t(D),{xs:24,sm:24,md:12,lg:12,xl:12},{default:e(()=>[a(t(E),{shadow:"hover",class:"chart-card"},{header:e(()=>s[9]||(s[9]=[l("div",{class:"card-header"},"标签分布",-1)])),default:e(()=>[a(t(mt),{modelValue:z.value,"onUpdate:modelValue":s[0]||(s[0]=r=>z.value=r),size:"small",style:{"margin-bottom":"15px"}},{default:e(()=>[a(t(L),{label:"all"},{default:e(()=>s[10]||(s[10]=[$("全部标签")])),_:1}),a(t(L),{label:"food"},{default:e(()=>s[11]||(s[11]=[$("美食标签")])),_:1}),a(t(L),{label:"post"},{default:e(()=>s[12]||(s[12]=[$("帖子标签")])),_:1})]),_:1},8,["modelValue"]),l("div",Ut,[a(t(W),{class:"chart",option:J.value,autoresize:""},null,8,["option"])])]),_:1})]),_:1})]),_:1})):k("",!0),!C.value&&!S.value?(v(),f(t(A),{key:4,class:"recent-content-row"},{default:e(()=>[a(t(D),{span:24},{default:e(()=>[a(t(E),{shadow:"hover"},{header:e(()=>s[13]||(s[13]=[l("div",{class:"card-header"},[l("span",null,"最近内容")],-1)])),default:e(()=>{var r;return[a(t(_t),{data:((r=o.value)==null?void 0:r.recentContent)||[],style:{width:"100%"}},{default:e(()=>[a(t(V),{prop:"id",label:"ID",width:"80"}),a(t(V),{prop:"title",label:"标题"}),a(t(V),{prop:"type",label:"类型",width:"120"},{default:e(n=>[a(t(wt),{type:n.row.type==="post"?"success":"primary"},{default:e(()=>[$(x(n.row.type==="post"?"帖子":"美食图片"),1)]),_:2},1032,["type"])]),_:1}),a(t(V),{prop:"createdAt",label:"创建时间",width:"180"},{default:e(n=>[$(x(Y(n.row.createdAt)),1)]),_:1}),a(t(V),{label:"操作",width:"120"},{default:e(n=>[a(t(N),{link:"",type:"primary",size:"small",onClick:u=>K(n.row)},{default:e(()=>s[14]||(s[14]=[$(" 查看 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]}),_:1})]),_:1})]),_:1})):k("",!0)]))}}),Pt=bt(Gt,[["__scopeId","data-v-03261d20"]]);export{Pt as default};
