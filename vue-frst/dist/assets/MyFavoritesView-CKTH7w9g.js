import{ah as h,d as k,r as g,X as C,o as w,G as c,y as x,c as m,a as v,q as F,w as E,u as i,J as M,a7 as P,P as S,e as A,Q as z,S as V,x as b,v as I,A as U,al as B,D as l,_ as L}from"./index-B8L1PXQk.js";import{S as N}from"./ShareCard-B8eI0k-J.js";import"./default-food-DJ8mVkvR.js";import"./formatters-Ce3ZkgnQ.js";class q{static async getMyFavorites(o){return(await h.get("/users/me/favorites",{params:o})).data}}const D={class:"my-favorites-view"},G={class:"view-title"},J={key:0,class:"loading-state"},Q={key:2,class:"posts-list"},T={key:0,class:"pagination-section"},X={name:"MyFavoritesView"},j=k({...X,setup(f){const o=g([]),u=g(!0),d=g(null),t=C({currentPage:1,pageSize:10,total:0}),p=async(r=t.currentPage)=>{var a,n;u.value=!0,d.value=null;try{const s=await q.getMyFavorites({page:r,limit:t.pageSize});if(s&&Array.isArray(s.posts))o.value=s.posts.map(e=>({id:e.id,title:e.title,content:e.content,imageUrl:e.imageUrl||null,createdAt:e.createdAt,updatedAt:e.updatedAt,authorId:e.authorId,author:e.author,likesCount:e.likesCount,commentsCount:e.commentsCount,favoritesCount:e.favoritesCount,isLiked:e.isLiked,isFavorited:e.isFavorited})),t.total=s.totalCount||0,t.currentPage=r;else throw new Error("加载收藏列表时返回数据格式不正确")}catch(s){const e=((n=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:n.message)||(s==null?void 0:s.message)||"加载收藏列表失败";d.value=e,U.error(e),o.value=[],t.total=0}finally{u.value=!1}},_=r=>{p(r)},y=r=>{const a=o.value.findIndex(n=>n.id===r.id);a!==-1&&(r.isFavorited?o.value[a]={...o.value[a],...r}:(o.value.splice(a,1),t.total=Math.max(0,t.total-1)))};return w(()=>{p()}),(r,a)=>(l(),c("div",D,[x("h2",G,[v(i(M),null,{default:E(()=>[v(i(B))]),_:1}),a[1]||(a[1]=F(" 我的收藏 "))]),u.value?(l(),c("div",J,[v(i(P),{rows:5,animated:""})])):d.value?(l(),m(i(S),{key:1,title:d.value,type:"error","show-icon":"",closable:!1,class:"error-alert"},null,8,["title"])):o.value.length>0?(l(),c("div",Q,[(l(!0),c(z,null,V(o.value,n=>(l(),m(N,{key:n.id,post:n,"onUpdate:post":y},null,8,["post"]))),128)),t.total>t.pageSize?(l(),c("section",T,[v(i(b),{background:"",layout:"prev, pager, next",total:t.total,"page-size":t.pageSize,"current-page":t.currentPage,"onUpdate:currentPage":a[0]||(a[0]=n=>t.currentPage=n),onCurrentChange:_},null,8,["total","page-size","current-page"])])):A("",!0)])):(l(),m(i(I),{key:3,description:"你还没有收藏任何帖子",class:"empty-state"}))]))}}),W=L(j,[["__scopeId","data-v-86bb2b0e"]]);export{W as default};
