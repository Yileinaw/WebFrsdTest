import{d as x,r as u,o as O,c as b,w as n,a as s,b as B,e as N,u as l,E as R,f as $,g as I,h as D,s as Y,i as j,j as h,k as q,l as H,m as K,n as d,p as P,q as E,t as M,v as Q,x as F,y as A,z as G,A as c,B as J,C as L,D as w,_ as W}from"./index-B8L1PXQk.js";import{A as X}from"./AdminService-D7bLfGG4.js";const Z=x({__name:"UserManagementView",setup(ee){const m=u([]),p=u(0),f=u(1),C=u(10),g=u(""),y=u(""),v=u(!1),r=async(t=f.value)=>{var a,o;v.value=!0,f.value=t;try{const e={page:f.value,pageSize:C.value};g.value&&(e.search=g.value),y.value&&(e.role=y.value);const i=await X.getUsers(e);i&&i.users?(m.value=i.users,p.value=i.total):(m.value=[],p.value=0,c.warning("未能获取用户数据"))}catch(e){console.error("获取用户列表失败:",e),m.value=[],p.value=0,c.error(((o=(a=e.response)==null?void 0:a.data)==null?void 0:o.message)||"获取用户列表失败，请检查网络或联系管理员")}finally{v.value=!1}},T=t=>{C.value=t,r(1)},V=t=>{r(t)},z=t=>J(t).format("YYYY-MM-DD HH:mm:ss"),S=t=>{switch(t){case"ADMIN":return"success";case"MODERATOR":return"warning";case"USER":return"success";default:return"info"}},U=t=>{switch(t){case"ADMIN":return"管理员";case"MODERATOR":return"版主";case"USER":return"用户";default:return t||"未知"}},_=t=>{console.log("编辑用户:",t),c.info(`触发编辑用户: ${t.username||t.email}`)},k=t=>{L.confirm(`确定要删除用户 “${t.username||t.email}” 吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{var a,o;try{v.value=!0,c.success("用户删除成功"),r()}catch(e){console.error("删除用户失败:",e),c.error(((o=(a=e.response)==null?void 0:a.data)==null?void 0:o.message)||"删除用户失败")}finally{v.value=!1}}).catch(()=>{c.info("取消删除")})};return O(()=>{r()}),(t,a)=>{const o=H("loading");return w(),b(l(G),{class:"user-management-card"},{header:n(()=>a[6]||(a[6]=[A("div",{class:"card-header"},[A("span",null,"用户管理")],-1)])),default:n(()=>[s(l(q),{gutter:20,class:"query-section"},{default:n(()=>[s(l(R),{span:8},{default:n(()=>[s(l($),{modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=e=>g.value=e),placeholder:"按用户名或邮箱搜索",clearable:"",onKeyup:a[2]||(a[2]=I(e=>r(1),["enter"])),onClear:a[3]||(a[3]=e=>r(1))},{append:n(()=>[s(l(D),{icon:l(Y),onClick:a[0]||(a[0]=e=>r(1))},null,8,["icon"])]),_:1},8,["modelValue"])]),_:1}),s(l(R),{span:6},{default:n(()=>[s(l(j),{modelValue:y.value,"onUpdate:modelValue":a[4]||(a[4]=e=>y.value=e),placeholder:"按角色筛选",clearable:"",onChange:a[5]||(a[5]=e=>r(1))},{default:n(()=>[s(l(h),{label:"管理员 (ADMIN)",value:"ADMIN"}),s(l(h),{label:"普通用户 (USER)",value:"USER"}),s(l(h),{label:"版主 (MODERATOR)",value:"MODERATOR"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),B((w(),b(l(K),{data:m.value,style:{width:"100%"},stripe:"",border:""},{empty:n(()=>[s(l(Q),{description:"暂无用户数据"})]),default:n(()=>[s(l(d),{prop:"id",label:"ID",width:"80"}),s(l(d),{prop:"username",label:"用户名",sortable:""}),s(l(d),{prop:"email",label:"邮箱",sortable:""}),s(l(d),{prop:"role",label:"角色",width:"120",align:"center"},{default:n(({row:e})=>[s(l(P),{type:S(e.role),effect:"light"},{default:n(()=>[E(M(U(e.role)),1)]),_:2},1032,["type"])]),_:1}),s(l(d),{prop:"createdAt",label:"注册时间",sortable:"",width:"180"},{default:n(({row:e})=>[E(M(z(e.createdAt)),1)]),_:1}),s(l(d),{label:"操作",width:"150",align:"center"},{default:n(({row:e})=>[s(l(D),{size:"small",type:"primary",onClick:i=>_(e)},{default:n(()=>a[7]||(a[7]=[E("编辑")])),_:2},1032,["onClick"]),s(l(D),{size:"small",type:"danger",onClick:i=>k(e)},{default:n(()=>a[8]||(a[8]=[E("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[o,v.value]]),p.value>0?(w(),b(l(F),{key:0,class:"pagination-container",background:"",layout:"prev, pager, next, jumper, ->, total, sizes",total:p.value,"page-size":C.value,"current-page":f.value,"page-sizes":[10,20,50,100],onSizeChange:T,onCurrentChange:V},null,8,["total","page-size","current-page"])):N("",!0)]),_:1})}}}),te=W(Z,[["__scopeId","data-v-36750e7f"]]);export{te as default};
