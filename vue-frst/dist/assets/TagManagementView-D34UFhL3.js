import{d as S,r as i,B as D,j as Z,c as B,b as o,e as t,u as l,aj as L,o as g,aq as O,k,g as b,aZ as P,aO as $,aP as Q,l as d,t as W,Q as m,aN as Y,s as G,V as M,Y as I,W as N,N as A,a as C,f as H,b1 as J,Z as s,a4 as K,_ as X}from"./index-u3ChIZEC.js";import{A as T}from"./AdminService-DpEl2DRV.js";const ee={class:"tag-management-view"},ae={class:"card-header"},le={key:2,style:{color:"#909399"}},te={class:"dialog-footer"},oe={class:"dialog-footer"},ne=S({__name:"TagManagementView",setup(se){const _=i([]),x=i(!1),y=i(null),f=i(!1),r=D({id:null,name:""}),u=i(null),V=i(),v=i(!1),c=D({name:""}),w=i(),F=i(!1),E=async()=>{x.value=!0,y.value=null;try{_.value=await T.getAllTags()}catch(a){console.error("[TagManagementView] Failed to fetch tags:",a),y.value="加载标签列表失败",_.value=[]}finally{x.value=!1}},h=a=>{var e;u.value=a,r.id=a.id??null,r.name=a.name,f.value=!0,(e=V.value)==null||e.clearValidate("name")},R=async()=>{var a;if(V.value)try{if(await V.value.validate(),u.value&&typeof u.value.id=="number"&&r.name!==u.value.name)try{await T.updateTag(u.value.id,{name:r.name}),s.success(`标签 "${u.value.name}" 更新为 "${r.name}" 成功`),f.value=!1,await E()}catch(e){console.error("[TagManagementView] Failed to update tag:",e);const p=e instanceof Error?e.message:"未知错误";s.error(`更新标签失败: ${p}`)}else r.name===((a=u.value)==null?void 0:a.name)?(s.info("标签名称未更改"),f.value=!1):s.error("无法更新标签，缺少必要信息或 ID 无效")}catch(e){console.log("Edit form validation failed:",e)}},U=async a=>{console.log("Attempting to delete tag:",a);try{if(await K.confirm(`确定要删除自定义标签 "${a.name}" 吗？此操作不可逆。`,"警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),typeof a.id>"u"||a.id===null){s.error("标签 ID 无效，无法删除");return}await T.deleteTag(a.id),s.success(`标签 "${a.name}" 删除成功`),await E()}catch(e){if(e==="cancel")s.info("已取消删除");else{console.error(`[TagManagementView] Failed to delete tag "${a.name}":`,e);const p=e instanceof Error?e.message:"未知错误";s.error(`删除标签 "${a.name}" 失败: ${p}`)}}},q=()=>{var a;c.name="",v.value=!0,(a=w.value)==null||a.clearValidate("name")},j=async()=>{if(w.value)try{await w.value.validate(),F.value=!0,console.log(`Creating tag with name: ${c.name}`);try{const a=await T.createTag({name:c.name});s.success(`标签 "${a.name}" 创建成功`),v.value=!1,await E()}catch(a){console.error("[TagManagementView] Failed to create tag:",a);const e=a instanceof Error?a.message:"未知错误";s.error(`创建标签失败: ${e}`)}}catch(a){console.log("Create form validation failed:",a)}finally{F.value=!1}};return Z(()=>{E()}),(a,e)=>{const p=P("loading");return g(),B("div",ee,[o(l(L),null,{header:t(()=>[C("div",ae,[e[7]||(e[7]=C("span",null,"标签管理",-1)),o(l(m),{type:"primary",onClick:q},{default:t(()=>[o(l(H),{style:{"margin-right":"5px"}},{default:t(()=>[o(l(J))]),_:1}),e[6]||(e[6]=d(" 新增标签 "))]),_:1})])]),default:t(()=>[O((g(),k(l(Y),{data:_.value,style:{width:"100%","margin-bottom":"20px"}},{default:t(()=>[o(l($),{prop:"name",label:"标签名称",sortable:""}),o(l($),{label:"类型",width:"120"},{default:t(({row:n})=>[o(l(Q),{type:n.isFixed?"info":"success"},{default:t(()=>[d(W(n.isFixed?"固定":"自定义"),1)]),_:2},1032,["type"])]),_:1}),o(l($),{label:"操作",width:"180"},{default:t(({row:n})=>[n.isFixed?b("",!0):(g(),k(l(m),{key:0,size:"small",onClick:z=>h(n)},{default:t(()=>e[8]||(e[8]=[d(" 编辑 ")])),_:2},1032,["onClick"])),n.isFixed?b("",!0):(g(),k(l(m),{key:1,size:"small",type:"danger",onClick:z=>U(n)},{default:t(()=>e[9]||(e[9]=[d(" 删除 ")])),_:2},1032,["onClick"])),n.isFixed?(g(),B("span",le,"-")):b("",!0)]),_:1})]),_:1},8,["data"])),[[p,x.value]]),y.value?(g(),k(l(G),{key:0,title:y.value,type:"error","show-icon":"",closable:!1},null,8,["title"])):b("",!0),o(l(M),{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=n=>f.value=n),title:"编辑标签",width:"30%","close-on-click-modal":!1},{footer:t(()=>[C("span",te,[o(l(m),{onClick:e[1]||(e[1]=n=>f.value=!1)},{default:t(()=>e[10]||(e[10]=[d("取消")])),_:1}),o(l(m),{type:"primary",onClick:R},{default:t(()=>e[11]||(e[11]=[d("确定")])),_:1})])]),default:t(()=>[o(l(I),{model:r,ref_key:"editFormRef",ref:V,"label-width":"80px"},{default:t(()=>[o(l(N),{label:"标签名称",prop:"name",rules:[{required:!0,message:"标签名称不能为空",trigger:"blur"}]},{default:t(()=>[o(l(A),{modelValue:r.name,"onUpdate:modelValue":e[0]||(e[0]=n=>r.name=n),placeholder:"请输入新的标签名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),o(l(M),{modelValue:v.value,"onUpdate:modelValue":e[5]||(e[5]=n=>v.value=n),title:"新增标签",width:"30%","close-on-click-modal":!1},{footer:t(()=>[C("span",oe,[o(l(m),{onClick:e[4]||(e[4]=n=>v.value=!1)},{default:t(()=>e[12]||(e[12]=[d("取消")])),_:1}),o(l(m),{type:"primary",onClick:j,loading:F.value},{default:t(()=>e[13]||(e[13]=[d("确定")])),_:1},8,["loading"])])]),default:t(()=>[o(l(I),{model:c,ref_key:"createFormRef",ref:w,"label-width":"80px"},{default:t(()=>[o(l(N),{label:"标签名称",prop:"name",rules:[{required:!0,message:"标签名称不能为空",trigger:"blur"}]},{default:t(()=>[o(l(A),{modelValue:c.name,"onUpdate:modelValue":e[3]||(e[3]=n=>c.name=n),placeholder:"请输入新标签名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1})])}}}),de=X(ne,[["__scopeId","data-v-27910c54"]]);export{de as default};
