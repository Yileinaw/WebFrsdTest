import{as as h,d as k,r as g,B as C,j as w,c,a as F,k as m,b as v,l as x,e as E,u as i,f as M,$ as P,s as S,g as A,F as b,v as z,a8 as V,q as B,Z as I,o as l,a1 as U,_ as L}from"./index-u3ChIZEC.js";import{S as N}from"./ShareCard-9IJNpXjv.js";import"./default-food-DJ8mVkvR.js";class j{static async getMyFavorites(o){return(await h.get("/users/me/favorites",{params:o})).data}}const q={class:"my-favorites-view"},T={class:"view-title"},Z={key:0,class:"loading-state"},$={key:2,class:"posts-list"},D={key:0,class:"pagination-section"},G={name:"MyFavoritesView"},H=k({...G,setup(f){const o=g([]),u=g(!0),d=g(null),t=C({currentPage:1,pageSize:10,total:0}),p=async(r=t.currentPage)=>{var a,n;u.value=!0,d.value=null;try{const s=await j.getMyFavorites({page:r,limit:t.pageSize});if(s&&Array.isArray(s.posts))o.value=s.posts.map(e=>({id:e.id,title:e.title,content:e.content,imageUrl:e.imageUrl||null,createdAt:e.createdAt,updatedAt:e.updatedAt,authorId:e.authorId,author:e.author,likesCount:e.likesCount,commentsCount:e.commentsCount,favoritesCount:e.favoritesCount,isLiked:e.isLiked,isFavorited:e.isFavorited})),t.total=s.totalCount||0,t.currentPage=r;else throw new Error("加载收藏列表时返回数据格式不正确")}catch(s){const e=((n=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:n.message)||(s==null?void 0:s.message)||"加载收藏列表失败";d.value=e,I.error(e),o.value=[],t.total=0}finally{u.value=!1}},_=r=>{p(r)},y=r=>{const a=o.value.findIndex(n=>n.id===r.id);a!==-1&&(r.isFavorited?o.value[a]={...o.value[a],...r}:(o.value.splice(a,1),t.total=Math.max(0,t.total-1)))};return w(()=>{p()}),(r,a)=>(l(),c("div",q,[F("h2",T,[v(i(M),null,{default:E(()=>[v(i(U))]),_:1}),a[1]||(a[1]=x(" 我的收藏 "))]),u.value?(l(),c("div",Z,[v(i(P),{rows:5,animated:""})])):d.value?(l(),m(i(S),{key:1,title:d.value,type:"error","show-icon":"",closable:!1,class:"error-alert"},null,8,["title"])):o.value.length>0?(l(),c("div",$,[(l(!0),c(b,null,z(o.value,n=>(l(),m(N,{key:n.id,post:n,"onUpdate:post":y},null,8,["post"]))),128)),t.total>t.pageSize?(l(),c("section",D,[v(i(V),{background:"",layout:"prev, pager, next",total:t.total,"page-size":t.pageSize,"current-page":t.currentPage,"onUpdate:currentPage":a[0]||(a[0]=n=>t.currentPage=n),onCurrentChange:_},null,8,["total","page-size","current-page"])])):A("",!0)])):(l(),m(i(B),{key:3,description:"你还没有收藏任何帖子",class:"empty-state"}))]))}}),Q=L(H,[["__scopeId","data-v-86bb2b0e"]]);export{Q as default};
