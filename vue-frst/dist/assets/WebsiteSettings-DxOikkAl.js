import{d as R,N as T,r as g,X as I,Y as b,ah as _,o as $,G as F,b as A,l as C,c as v,w as l,A as i,an as n,a as t,u as D,bc as z,y as h,q as j,t as q,a2 as H,D as f,_ as K}from"./index-B8L1PXQk.js";const X={class:"p-4 md:p-6 bg-gray-50 min-h-screen"},Y=R({__name:"WebsiteSettings",setup(Q){const S=T(),L=g(),s=I({siteTitle:"",copyright:"",contactEmail:"",logoUrl:""}),m=g(!1),p=g(!1),y=g(null),w=b(()=>({Authorization:`Bearer ${S.token}`})),B=b(()=>{const e=s.logoUrl;if(!e)return"";if(e.startsWith("http://")||e.startsWith("https://"))return e;const o=_.defaults.baseURL||"",r=o.endsWith("/")?o:`${o}/`,a=r.replace(/api\/?$/,""),c=e.startsWith("/")?e.substring(1):e,u=`${a}uploads/${c}`;return console.log("[resolvedLogoUrl] Original:",e,"API Base Source:",o,"Resolved API Base:",r,"Static Base:",a,"Resolved:",u),u});async function E(){m.value=!0,console.log("Fetching settings...");try{const e=await _.get("/settings"),o=Object.keys(s);for(const r in e.data)o.includes(r)&&(s[r]=e.data[r]);console.log("Settings fetched:",JSON.parse(JSON.stringify(s)))}catch(e){console.error("Error fetching settings:",e),i.error("加载网站设置失败")}finally{m.value=!1}}async function U(){p.value=!0,console.log("Saving settings:",JSON.parse(JSON.stringify(s)));try{await _.put("/settings",s),i.success("网站设置已成功保存！")}catch(e){console.error("Error saving settings:",e),i.error("保存网站设置失败")}finally{p.value=!1}}const x=(e,o)=>{console.log("Logo upload success response:",e),e&&e.logoUrl?(s.logoUrl=e.logoUrl,i.success("Logo 上传成功！"),console.log("Logo uploaded, new URL:",s.logoUrl)):(console.error("Logo upload success but response missing logoUrl:",e),i.error("Logo 上传成功，但未能获取新 Logo 地址"))},V=(e,o,r)=>{console.error("Logo upload error:",e);let a="Logo 上传失败";try{a=JSON.parse(e.message).message||a}catch{a=e.message||a}y.value=a,i.error(a)},k=e=>{if(!["image/png","image/jpeg","image/gif","image/webp"].includes(e.type))return i.error("文件类型无效！请上传 PNG, JPG, GIF 或 WEBP 格式的图片。"),!1;const r=2;return e.size/1024/1024>r?(i.error(`文件过大！请上传小于 ${r}MB 的图片。`),!1):(y.value=null,!0)};return $(()=>{E()}),(e,o)=>{const r=n("el-input"),a=n("el-form-item"),c=n("el-col"),u=n("el-row"),N=n("el-image"),P=n("el-icon"),W=n("el-upload"),G=n("el-button"),J=n("el-form"),M=n("el-card"),O=C("loading");return f(),F("div",X,[A((f(),v(M,{shadow:"never"},{header:l(()=>o[3]||(o[3]=[h("div",{class:"card-header"},[h("span",{class:"text-xl font-semibold"},"网站设置")],-1)])),default:l(()=>[t(J,{model:s,"label-width":"120px","label-position":"top",onSubmit:H(U,["prevent"])},{default:l(()=>[t(u,{gutter:20},{default:l(()=>[t(c,{span:12},{default:l(()=>[t(a,{label:"网站标题",prop:"siteTitle",rules:[{required:!0,message:"请输入网站标题",trigger:"blur"}]},{default:l(()=>[t(r,{modelValue:s.siteTitle,"onUpdate:modelValue":o[0]||(o[0]=d=>s.siteTitle=d),placeholder:"请输入网站标题"},null,8,["modelValue"])]),_:1})]),_:1}),t(c,{span:12},{default:l(()=>[t(a,{label:"版权信息",prop:"copyright"},{default:l(()=>[t(r,{modelValue:s.copyright,"onUpdate:modelValue":o[1]||(o[1]=d=>s.copyright=d),placeholder:"例如： 2024 您的网站名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(u,{gutter:20},{default:l(()=>[t(c,{span:12},{default:l(()=>[t(a,{label:"联系邮箱",prop:"contactEmail"},{default:l(()=>[t(r,{modelValue:s.contactEmail,"onUpdate:modelValue":o[2]||(o[2]=d=>s.contactEmail=d),type:"email",placeholder:"请输入联系邮箱地址"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(a,{label:"网站 Logo",prop:"logoUrl"},{default:l(()=>[t(W,{ref_key:"uploadRef",ref:L,action:"/api/settings/upload-logo",headers:w.value,name:"logo","show-file-list":!1,"on-success":x,"on-error":V,"before-upload":k,limit:1,"auto-upload":!0,class:"logo-uploader"},{tip:l(()=>o[4]||(o[4]=[h("div",{class:"el-upload__tip"}," 点击上传 Logo。建议尺寸：200x200 像素，格式：PNG, JPG, GIF, WEBP，大小不超过 2MB。 ",-1)])),default:l(()=>[s.logoUrl?(f(),v(N,{key:0,src:B.value,class:"logo-image",fit:"contain",style:{width:"178px",height:"178px"}},null,8,["src"])):(f(),v(P,{key:1,class:"logo-uploader-icon"},{default:l(()=>[t(D(z))]),_:1}))]),_:1},8,["headers"])]),_:1}),t(a,null,{default:l(()=>[t(G,{type:"primary",onClick:U,loading:p.value},{default:l(()=>[j(q(p.value?"保存中...":"保存设置"),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})),[[O,m.value]])])}}}),ee=K(Y,[["__scopeId","data-v-6b225671"]]);export{ee as default};
