import{d as Q,r as d,Y as W,X as A,o as Z,G as N,a as t,w as o,u as l,z as ee,y,b as ae,c as _,e as C,an as R,q as u,l as le,n as I,p as te,t as oe,h as p,m as ne,P as se,ag as S,ak as q,ai as k,f as z,i as P,j as x,J as re,bc as ie,A as m,C as de,D as V,_ as ue}from"./index-B8L1PXQk.js";import{F}from"./FoodTagService-DowZCzBf.js";import{P as $}from"./PostTagService-CUB2YNF0.js";const me={class:"tag-management-view"},fe={class:"card-header"},pe={class:"tag-type-selector"},ve={key:2,style:{color:"#909399"}},ge={class:"dialog-footer"},ce={class:"dialog-footer"},ye=Q({__name:"TagManagementView",setup(Ve){const i=d("food"),D=d([]),M=d([]),h=W(()=>i.value==="food"?D.value:M.value),B=d(!1),T=d(null),v=d(!1),s=A({id:null,name:"",type:"food"}),f=d(null),b=d(),w=d(!1),r=A({name:"",type:"food"}),E=d(),U=d(!1),g=async()=>{B.value=!0,T.value=null;try{i.value==="food"?D.value=await F.getAllTags():M.value=await $.getAllTags()}catch(a){console.error("[TagManagementView] Failed to fetch tags:",a),T.value="加载标签列表失败",i.value==="food"?D.value=[]:M.value=[]}finally{B.value=!1}},j=a=>{var e;f.value=a,s.id=a.id??null,s.name=a.name,s.type=i.value,v.value=!0,(e=b.value)==null||e.clearValidate("name")},G=async()=>{var a;if(b.value)try{if(await b.value.validate(),f.value&&typeof f.value.id=="number"&&s.name!==f.value.name)try{s.type==="food"?await F.updateTag(f.value.id,s.name):await $.updateTag(f.value.id,s.name),m.success(`标签 "${f.value.name}" 更新为 "${s.name}" 成功`),v.value=!1,await g()}catch(e){console.error("[TagManagementView] Failed to update tag:",e);const c=e instanceof Error?e.message:"未知错误";m.error(`更新标签失败: ${c}`)}else s.name===((a=f.value)==null?void 0:a.name)?(m.info("标签名称未更改"),v.value=!1):m.error("无法更新标签，缺少必要信息或 ID 无效")}catch(e){console.log("Edit form validation failed:",e)}},J=async a=>{console.log("Attempting to delete tag:",a);try{if(await de.confirm(`确定要删除自定义标签 "${a.name}" 吗？此操作不可逆。`,"警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),typeof a.id>"u"||a.id===null){m.error("标签 ID 无效，无法删除");return}i.value==="food"?await F.deleteTag(a.id):await $.deleteTag(a.id),m.success(`标签 "${a.name}" 删除成功`),await g()}catch(e){if(e==="cancel")m.info("已取消删除");else{console.error(`[TagManagementView] Failed to delete tag "${a.name}":`,e);const c=e instanceof Error?e.message:"未知错误";m.error(`删除标签 "${a.name}" 失败: ${c}`)}}},L=()=>{var a;r.name="",r.type=i.value,w.value=!0,(a=E.value)==null||a.clearValidate("name")},O=async()=>{if(E.value)try{await E.value.validate(),U.value=!0,console.log(`Creating ${r.type} tag with name: ${r.name}`);try{let a;r.type==="food"?a=await F.createTag(r.name):a=await $.createTag(r.name),m.success(`标签 "${a.name}" 创建成功`),w.value=!1,await g()}catch(a){console.error("[TagManagementView] Failed to create tag:",a);const e=a instanceof Error?a.message:"未知错误";m.error(`创建标签失败: ${e}`)}}catch(a){console.log("Create form validation failed:",a)}finally{U.value=!1}},X=a=>{typeof a=="string"?(i.value=a,g()):console.warn("[TagManagementView] Unexpected type received for tag type change:",a)};return Z(()=>{g(),i.value="post",g(),i.value="food"}),(a,e)=>{const c=R("el-radio-button"),Y=R("el-radio-group"),H=le("loading");return V(),N("div",me,[t(l(ee),null,{header:o(()=>[y("div",fe,[e[10]||(e[10]=y("span",null,"标签管理",-1)),t(l(p),{type:"primary",onClick:L},{default:o(()=>[t(l(re),{style:{"margin-right":"5px"}},{default:o(()=>[t(l(ie))]),_:1}),e[9]||(e[9]=u(" 新增标签 "))]),_:1})])]),default:o(()=>[y("div",pe,[t(Y,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=n=>i.value=n),onChange:X},{default:o(()=>[t(c,{label:"food"},{default:o(()=>e[11]||(e[11]=[u("美食标签")])),_:1}),t(c,{label:"post"},{default:o(()=>e[12]||(e[12]=[u("帖子标签")])),_:1})]),_:1},8,["modelValue"])]),ae((V(),_(l(ne),{data:h.value,style:{width:"100%","margin-bottom":"20px"}},{default:o(()=>[t(l(I),{prop:"name",label:"标签名称",sortable:""}),t(l(I),{label:"类型",width:"120"},{default:o(({row:n})=>[t(l(te),{type:n.isFixed?"info":"success"},{default:o(()=>[u(oe(n.isFixed?"固定":"自定义"),1)]),_:2},1032,["type"])]),_:1}),t(l(I),{label:"操作",width:"180"},{default:o(({row:n})=>[n.isFixed?C("",!0):(V(),_(l(p),{key:0,size:"small",onClick:K=>j(n)},{default:o(()=>e[13]||(e[13]=[u(" 编辑 ")])),_:2},1032,["onClick"])),n.isFixed?C("",!0):(V(),_(l(p),{key:1,size:"small",type:"danger",onClick:K=>J(n)},{default:o(()=>e[14]||(e[14]=[u(" 删除 ")])),_:2},1032,["onClick"])),n.isFixed?(V(),N("span",ve,"-")):C("",!0)]),_:1})]),_:1},8,["data"])),[[H,B.value]]),T.value?(V(),_(l(se),{key:0,title:T.value,type:"error","show-icon":"",closable:!1},null,8,["title"])):C("",!0),t(l(S),{modelValue:v.value,"onUpdate:modelValue":e[4]||(e[4]=n=>v.value=n),title:"编辑标签",width:"30%","close-on-click-modal":!1},{footer:o(()=>[y("span",ge,[t(l(p),{onClick:e[3]||(e[3]=n=>v.value=!1)},{default:o(()=>e[16]||(e[16]=[u("取消")])),_:1}),t(l(p),{type:"primary",onClick:G},{default:o(()=>e[17]||(e[17]=[u("确定")])),_:1})])]),default:o(()=>[t(l(q),{model:s,ref_key:"editFormRef",ref:b,"label-width":"80px"},{default:o(()=>[t(l(k),{label:"标签名称",prop:"name",rules:[{required:!0,message:"标签名称不能为空",trigger:"blur"}]},{default:o(()=>[t(l(z),{modelValue:s.name,"onUpdate:modelValue":e[1]||(e[1]=n=>s.name=n),placeholder:"请输入新的标签名称"},null,8,["modelValue"])]),_:1}),t(l(k),{label:"标签类型",prop:"type"},{default:o(()=>[t(l(P),{modelValue:s.type,"onUpdate:modelValue":e[2]||(e[2]=n=>s.type=n),placeholder:"请选择标签类型",disabled:""},{default:o(()=>[t(l(x),{label:"美食标签",value:"food"}),t(l(x),{label:"帖子标签",value:"post"})]),_:1},8,["modelValue"]),e[15]||(e[15]=y("div",{class:"form-help-text"},"标签类型不可更改",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(l(S),{modelValue:w.value,"onUpdate:modelValue":e[8]||(e[8]=n=>w.value=n),title:"新增标签",width:"30%","close-on-click-modal":!1},{footer:o(()=>[y("span",ce,[t(l(p),{onClick:e[7]||(e[7]=n=>w.value=!1)},{default:o(()=>e[18]||(e[18]=[u("取消")])),_:1}),t(l(p),{type:"primary",onClick:O,loading:U.value},{default:o(()=>e[19]||(e[19]=[u("确定")])),_:1},8,["loading"])])]),default:o(()=>[t(l(q),{model:r,ref_key:"createFormRef",ref:E,"label-width":"80px"},{default:o(()=>[t(l(k),{label:"标签名称",prop:"name",rules:[{required:!0,message:"标签名称不能为空",trigger:"blur"}]},{default:o(()=>[t(l(z),{modelValue:r.name,"onUpdate:modelValue":e[5]||(e[5]=n=>r.name=n),placeholder:"请输入新标签名称"},null,8,["modelValue"])]),_:1}),t(l(k),{label:"标签类型",prop:"type"},{default:o(()=>[t(l(P),{modelValue:r.type,"onUpdate:modelValue":e[6]||(e[6]=n=>r.type=n),placeholder:"请选择标签类型"},{default:o(()=>[t(l(x),{label:"美食标签",value:"food"}),t(l(x),{label:"帖子标签",value:"post"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1})])}}}),Ee=ue(ye,[["__scopeId","data-v-2f542ebd"]]);export{Ee as default};
