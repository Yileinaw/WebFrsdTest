import{d as L,N as b,r as k,c as C,w as i,e as B,y as o,u as t,I as D,a9 as w,a as n,J as U,K as A,L as N,t as l,h as p,U as F,q as v,aa as V,ab as z,aP as M,a2 as q,ad as J,z as K,M as R,A as u,T as d,D as P,_ as $}from"./index-B8L1PXQk.js";import{_ as j}from"./default-food-DJ8mVkvR.js";import{f as x,t as G}from"./formatters-Ce3ZkgnQ.js";const H={class:"image-slot"},O={class:"card-content"},Q={class:"author-info"},W={class:"author-details"},X={class:"author-name"},Y={class:"post-time"},Z={class:"post-body"},ss={class:"post-text"},ts={class:"actions"},os=L({__name:"ShareCard",props:{post:{}},emits:["update:post"],setup(E,{emit:I}){const r=E,h=I,g=R(),y=b(),f=k(!1),m=k(!1),_=()=>{g.push({name:"PostDetail",params:{id:r.post.id}})},S=async()=>{var s,e;if(!y.isLoggedIn){u.warning("请先登录"),g.push("/login");return}f.value=!0;try{r.post.isLiked?await d.unlikePost(r.post.id):await d.likePost(r.post.id);const c=(await d.getPostById(r.post.id)).post;h("update:post",c)}catch(a){console.error("Toggle like error:",a),u.error(((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"操作失败")}finally{f.value=!1}},T=async()=>{var s,e;if(!y.isLoggedIn){u.warning("请先登录"),g.push("/login");return}m.value=!0;try{r.post.isFavorited?await d.unfavoritePost(r.post.id):await d.favoritePost(r.post.id);const c=(await d.getPostById(r.post.id)).post;h("update:post",c)}catch(a){console.error("Toggle favorite error:",a),u.error(((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"操作失败")}finally{m.value=!1}};return(s,e)=>(P(),C(t(K),{"body-style":{padding:"0px"},class:"share-card"},{default:i(()=>{var a,c;return[s.post.imageUrl?(P(),C(t(D),{key:0,src:t(w)(s.post.imageUrl||""),fit:"cover",class:"post-image",lazy:"",onClick:_},{placeholder:i(()=>e[0]||(e[0]=[o("div",{class:"image-slot"},"加载中...",-1)])),error:i(()=>[o("div",H,[n(t(U),null,{default:i(()=>[n(t(A))]),_:1})])]),_:1},8,["src"])):B("",!0),o("div",O,[o("div",Q,[n(t(N),{size:40,src:t(w)(((a=s.post.author)==null?void 0:a.avatarUrl)||""),onError:es=>!0},{default:i(()=>e[1]||(e[1]=[o("img",{src:j},null,-1)])),_:1},8,["src"]),o("div",W,[o("span",X,l(((c=s.post.author)==null?void 0:c.name)||"匿名用户"),1),o("span",Y,l(t(x)(s.post.createdAt)),1)])]),o("div",Z,[o("h3",{class:"post-title",onClick:_},l(s.post.title),1),o("p",ss,l(t(G)(s.post.content,100)),1)]),o("div",ts,[n(t(p),{type:s.post.isLiked?"primary":"",icon:t(F),text:"",bg:"",onClick:S,loading:f.value},{default:i(()=>[v(l(s.post.likesCount||0)+" 点赞 ",1)]),_:1},8,["type","icon","loading"]),n(t(p),{icon:t(V),text:"",bg:"",onClick:_},{default:i(()=>[v(l(s.post.commentsCount||0)+" 评论 ",1)]),_:1},8,["icon"]),n(t(p),{type:s.post.isFavorited?"warning":"",icon:t(z),text:"",bg:"",onClick:T,loading:m.value},{default:i(()=>[v(l(s.post.favoritesCount||0)+" 收藏 ",1)]),_:1},8,["type","icon","loading"]),n(t(M),{content:"更多操作",placement:"top"},{default:i(()=>[n(t(p),{icon:t(J),text:"",circle:"",class:"more-options",onClick:q(()=>{},["stop"])},null,8,["icon"])]),_:1})])])]}),_:1}))}}),ns=$(os,[["__scopeId","data-v-f0fc210e"]]);export{ns as S};
