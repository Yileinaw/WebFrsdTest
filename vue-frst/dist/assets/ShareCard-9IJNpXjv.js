import{d as b,U as D,r as w,k as I,o as P,u as s,aj as B,e as n,g as N,a as o,E as S,a0 as M,b as c,f as U,p as $,h as A,t as u,Q as y,y as L,l as C,aB as F,aC as V,aA as z,I as j,ap as q,i as H,Z as k,P as h,_ as Q}from"./index-u3ChIZEC.js";import{_ as R}from"./default-food-DJ8mVkvR.js";function Y(e){if(!e)return"未知时间";const d=typeof e=="string"?new Date(e):e;if(isNaN(d.getTime()))return"无效日期";const v=Math.floor((new Date().getTime()-d.getTime())/1e3),p=Math.floor(v/60),f=Math.floor(p/60),l=Math.floor(f/24),g=Math.floor(l/30),m=Math.floor(l/365);return m>0?`${m} 年前`:g>0?`${g} 个月前`:l>0?`${l} 天前`:f>0?`${f} 小时前`:p>0?`${p} 分钟前`:"刚刚"}function Z(e,d){return e?e.length<=d?e:e.substring(0,d)+"...":""}const G={class:"image-slot"},J={class:"card-content"},K={class:"author-info"},O={class:"author-details"},W={class:"author-name"},X={class:"post-time"},x={class:"post-body"},tt={class:"post-text"},st={class:"actions"},ot=b({__name:"ShareCard",props:{post:{}},emits:["update:post"],setup(e,{emit:d}){const a=e,v=d,p=H(),f=D(),l=w(!1),g=w(!1),m=()=>{p.push({name:"PostDetail",params:{id:a.post.id}})},T=async()=>{var t,r;if(!f.isLoggedIn){k.warning("请先登录"),p.push("/login");return}l.value=!0;try{a.post.isLiked?await h.unlikePost(a.post.id):await h.likePost(a.post.id);const _=(await h.getPostById(a.post.id)).post;v("update:post",_)}catch(i){console.error("Toggle like error:",i),k.error(((r=(t=i.response)==null?void 0:t.data)==null?void 0:r.message)||"操作失败")}finally{l.value=!1}},E=async()=>{var t,r;if(!f.isLoggedIn){k.warning("请先登录"),p.push("/login");return}g.value=!0;try{a.post.isFavorited?await h.unfavoritePost(a.post.id):await h.favoritePost(a.post.id);const _=(await h.getPostById(a.post.id)).post;v("update:post",_)}catch(i){console.error("Toggle favorite error:",i),k.error(((r=(t=i.response)==null?void 0:t.data)==null?void 0:r.message)||"操作失败")}finally{g.value=!1}};return(t,r)=>(P(),I(s(B),{"body-style":{padding:"0px"},class:"share-card"},{default:n(()=>{var i,_;return[t.post.imageUrl?(P(),I(s(S),{key:0,src:s(M)(t.post.imageUrl||""),fit:"cover",class:"post-image",lazy:"",onClick:m},{placeholder:n(()=>r[0]||(r[0]=[o("div",{class:"image-slot"},"加载中...",-1)])),error:n(()=>[o("div",G,[c(s(U),null,{default:n(()=>[c(s($))]),_:1})])]),_:1},8,["src"])):N("",!0),o("div",J,[o("div",K,[c(s(A),{size:40,src:s(M)(((i=t.post.author)==null?void 0:i.avatarUrl)||""),onError:et=>!0},{default:n(()=>r[1]||(r[1]=[o("img",{src:R},null,-1)])),_:1},8,["src"]),o("div",O,[o("span",W,u(((_=t.post.author)==null?void 0:_.name)||"匿名用户"),1),o("span",X,u(s(Y)(t.post.createdAt)),1)])]),o("div",x,[o("h3",{class:"post-title",onClick:m},u(t.post.title),1),o("p",tt,u(s(Z)(t.post.content,100)),1)]),o("div",st,[c(s(y),{type:t.post.isLiked?"primary":"",icon:s(L),text:"",bg:"",onClick:T,loading:l.value},{default:n(()=>[C(u(t.post.likesCount||0)+" 点赞 ",1)]),_:1},8,["type","icon","loading"]),c(s(y),{icon:s(F),text:"",bg:"",onClick:m},{default:n(()=>[C(u(t.post.commentsCount||0)+" 评论 ",1)]),_:1},8,["icon"]),c(s(y),{type:t.post.isFavorited?"warning":"",icon:s(V),text:"",bg:"",onClick:E,loading:g.value},{default:n(()=>[C(u(t.post.favoritesCount||0)+" 收藏 ",1)]),_:1},8,["type","icon","loading"]),c(s(z),{content:"更多操作",placement:"top"},{default:n(()=>[c(s(y),{icon:s(q),text:"",circle:"",class:"more-options",onClick:j(()=>{},["stop"])},null,8,["icon"])]),_:1})])])]}),_:1}))}}),it=Q(ot,[["__scopeId","data-v-1a711bc9"]]);export{it as S};
